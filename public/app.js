function w(b){return(...a)=>{var d={};a=b.call(d,...a);a=(new DOMParser).parseFromString(a,"text/html").getElementsByTagName("body").item(0).firstChild;d=d.init(a);d.node=a;return d}}stynj("#nav{background:rgba(0,0,0,.5);height:50px;display:flex;font-size:10px;justify-content:center}.navc{justify-content:space-around;align-self:center;max-width:500px}.navc .sel{color:#db8b1d}#nav>ul>li>.l{-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0}");
const z=DOMTokenList.prototype;function C(b,...a){z.add.call(b.classList,...a)}function E(b,...a){z.remove.call(b.classList,...a)}
const G=setTimeout,H=document,I=window,L=H.createElement.bind(H),M=H.createElement.bind(H,"div"),O=H.getElementById.bind(H),aa=(b,a=H)=>a.getElementsByTagName.call(a,b),P=(b,a=H)=>a.querySelector.call(a,b),ba=b=>b.stopPropagation(),ca=(b,a)=>Q.call(b,a),Q=H.appendChild,S=b=>b&&"object"===typeof b&&!Array.isArray(b),U=(b,...a)=>{if(!a.length)return b;const d=a.shift();if(S(b)&&S(d))for(const e in d)S(d[e])?(b[e]||Object.assign(b,{[e]:{}}),U(b[e],d[e])):Object.assign(b,{[e]:d[e]});return U(b,...a)},
da=(b,a)=>Object.keys(a).reduce((d,e)=>{if(b[e]===a[e]||null==a[e])return d;if(S(b[e])&&S(a[e])){const h=da(b[e],a[e]);return 0===Object.keys(h).length?d:{...d,[e]:h}}return{...d,[e]:a[e]}},{}),ea=b=>new Promise(a=>{setTimeout(a,b)}),fa=b=>{const a={};for(const d in b)null!=b[d]&&(a[d]=b[d]);return a},V=[],ha=b=>{const a=V.push(b);return()=>{delete V[a-1]}},ia=()=>{V.forEach(b=>{b&&b()})};let ja=location.search;
const W=(b,a,d)=>{a=a||{};null==d&&(d=!0);const e=location.pathname,h=location.search;d=new URLSearchParams(d?"":h);for(const p in a)d.set(p,a[p]);a=d.toString();0<a.length&&(a="?"+a);if(b!==e||a!==h)history.pushState(null,"",(b||e)+a),a!==h&&ia()},ka=w(function({labels:b}){let a=0,d=[];const e=[];this.init=h=>{const p=v=>{a=v;e.forEach((q,r)=>{r===a?C(q,"sel"):E(q,"sel")});d.map(q=>q(v))};b.map((v,q)=>{const r=L("li");C(r,"fC");q===a&&C(r,"sel");var f=L("i");Q.call(f,v.i);Q.call(r,f);f=L("p");C(f,
"l");f.innerText=v.t;Q.call(r,f);e.push(r);Q.call(h,r);r.onclick=()=>p(q)});return{onClick:v=>{d.push(v)},currentIndex:()=>a,destroy:()=>{d=[]},setIndex:p}};return'<ul class="fw navc"></ul>'});stynj(":root{--oc:#1d95db;--cc:#606060}.sc{pointer-events:none;padding:20px;align-self:center;align-items:center;justify-content:center;height:59%;overflow-x:hidden;width:50vh}.slider{pointer-events:all;transform:rotate(90deg);background:linear-gradient(90deg,var(--cc) 0,var(--cc) 50%,var(--oc) 0,var(--oc));height:7px;outline:none;border-radius:15px;height:150px;-webkit-appearance:none;-moz-appearance:none;appearance:none;width:400px}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:30px;transform:translateX(-15px);height:70px;background:transparent;border-right:2px solid #fff;box-shadow:#000;cursor:pointer}");
const Y=(b,a,d,e,h,p)=>{a=(a-d)/(e-d)*100;b.style.background=`linear-gradient(to right, ${h} 0%, ${h} ${a}%, ${p} ${a}%, ${p} 100%`},la=w(function({value:b}){let a=[];this.init=d=>{const e=P("input",d);e.onmousedown=e.ontouchstart=ba;const h=parseInt,p=h(e.min),v=h(e.max);e.oninput=()=>{const q=h(e.value);Y(e,q,p,v,"#606060","#1d95db")};e.onchange=()=>{const q=h(e.value);a.forEach(r=>r(q))};e.value=`${b}`;Y(e,b,p,v,"#606060","#1d95db");return{destroy:()=>{a=[]},onChange:q=>{a.push(q)}}};return'<div class="sc flex"><input class="slider" type="range" min="0" max="100"></div>'});
stynj('#card{position:fixed;top:100%;background:rgb(9 9 9/88%);border-radius:30px 30px 0 0;text-align:left;justify-content:center;font-size:12px}#card:after{content:"-";transform:scaleX(20) translate(.5px);position:fixed;color:var(--cc)}#card.an,#card>.an{transition:top .2s ease-in-out}.in{text-align:left}.ca-con{width:80%;max-width:300px;padding-top:50px}.cR{margin-bottom:50px}#card .act{position:fixed;right:23px;top:100%;font-size:20px;font-weight:100;transform:scaleX(1.3)}');stynj(':root{--c:#1d95db}.in{justify-content:space-between;height:50px;align-items:center;background:rgba(0,0,0,.56);padding:0 0 0 15px;border-radius:15px;min-width:300px;font-size:14px}.in.disabled{color:grey}.in>label{font-weight:700}.igroup>.in{margin-top:0;border-radius:0;border-bottom:1px solid hsla(0,0%,100%,.30196078431372547)}.igroup>.in:first-child{border-radius:15px 15px 0 0;margin-top:20px}.igroup>.in:last-child{border-radius:0 0 15px 15px;margin-bottom:20px;border-bottom:none}.in-r{background:linear-gradient(90deg,var(--c) 0,var(--c) 50%,#606060 0,#606060);border-radius:8px;height:7px;width:75%;border-radius:15px;height:6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;outline:none}.in-r::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:#fff;box-shadow:#000;border-radius:50%;cursor:pointer}.in>input:not([type=checkbox]),.in>select{flex-grow:1;padding:10px 27px 10px 0;background:transparent;border:none;color:#db8b1d;-moz-text-align-last:right;text-align-last:right;-webkit-appearance:none;-moz-appearance:none;text-align:right}.in>select+span{left:-10px;transform:scale(1.6,.9) translateY(-1px);font-weight:200;color:#db8b1d}.in>span{color:#5f5f5f;position:relative;font-size:12px;pointer-events:none;margin-left:-20px;left:-5px}.in>select{margin-inline:12px}.in:focus-within{box-shadow:inset -1px 0 rgba(219,139,29,.627)}.in>input:is([type=checkbox]){margin-right:15px}.in>input:disabled{color:grey}input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:51px;height:31px;border-radius:50px;background-color:rgba(148,148,154,.2)!important}[type=checkbox]:after{content:"";width:50%;border-radius:100%;height:80%;display:block;position:relative;background-color:#fff;top:12%;left:3%;transition:all .2s ease-in-out}[type=checkbox].on{background-color:#34c759!important}[type=checkbox].on:after{left:45%}');
const na={[1]:"text",[2]:"checkbox",[0]:"number",[3]:"select",[4]:"password",[5]:"range"},oa=w(function({label:b,type:a,enumOpts:d,placeholder:e,value:h,unit:p,embed:v=!0,prevDefault:q=!1,min:r,max:f}){let k=h,g,t=[];const m=c=>{function n(u){""===u&&(u=void 0);k=u;t.forEach(A=>A(k))}c.innerHTML="";v&&C(c,"in");var x=L("label");x.innerText=b;Q.call(c,x);3===a?(g=L("select"),C(c,"in-s"),d.forEach(u=>{const A=L("option");A.value=u.v;A.innerText=u.l;Q.call(g,A)}),g.onchange=u=>{q&&u.preventDefault();
n(d[g.options.selectedIndex].v)}):(g=L("input"),g.type=na[a],g.placeholder=e||"xxxxx",null!=r&&(g.min=`${r}`),null!=f&&(g.max=`${f}`),5===a&&C(g,"in-r"),2===a?((g.checked=h)&&C(g,"on"),g.onchange=u=>{q&&u.preventDefault();z.toggle.call(g.classList,"on");n(g.checked)}):g.onchange=u=>{q&&u.preventDefault();n(g.value)});null!=h&&(g.value=h);g.id=x.htmlFor=`in-${b.split(" ").join("-")}`;Q.call(c,g);if(3===a||p)x=L("span"),x.innerText=p?p:"v",Q.call(c,x)};this.init=c=>{m(c);return{onChange:n=>{t.push(n)},
setDisabled:n=>{z.toggle.call(c.classList,"disabled");g.disabled=n},destroy:()=>{t=[]},reset:()=>{m(c)},isDirty:()=>h!==k}};return'<div class="fR"></div>'}),pa=["Speed","Acceleration"],qa=[[1,5E3],[1,4294967294]],ra=w(function({pos:b,accel:a,speed:d,...e}){let h=[],p=!1,v=0,q=0,r=!1,f={},k=[];this.init=g=>{function t(l){null==l&&(l=!1);l!==r&&(l?C(g,"an"):E(g,"an"),l?C(c,"an"):E(c,"an"),r=l)}const m=P(".ca-con",g),c=P(".act",g);t(!0);const n=l=>{h.forEach(D=>D(l))},x=l=>{const D=0===l?d:a,J=oa({type:5,
label:pa[l],value:D,embed:!1,min:qa[l][0],max:qa[l][1]}),F=P("input",J.node);E(J.node,"fR");C(J.node,"cR");const K=parseInt,N=K(F.min),X=K(F.max);F.oninput=()=>{const R=K(F.value);Y(F,R,N,X,"#1d95db","#606060")};J.onChange(R=>{0===l?n({speed:R,...e}):1===l&&n({accel:R,...e})});Q.call(m,J.node);Y(F,D,N,X,"#1d95db","#606060");k.push(J)};x(0);x(1);const u=la({value:b});u.onChange(l=>{n({tPos:l,...e})});Q.call(m,u.node);const A=()=>{t(!0);g.ontransitionend=B;const l=g.clientHeight;g.style.top=`${l}px`;
c.style.top=`${l+12}px`};c.onclick=A;const B=()=>{h=[];u.destroy();k.forEach(l=>l.destroy());k=[];g.remove()},y=l=>{let {x:D,y:J}=l;null==D&&(D=l.touches[0].clientX,J=l.touches[0].clientY);return{x:D,y:J}};g.onmousedown=g.ontouchstart=l=>{f=l=y(l);q=l.y;p=!0;t(!1)};g.onmouseup=g.onmouseout=g.ontouchend=()=>{if(p){p=!1;t(!0);if(v>g.clientHeight/2)return A();g.style.top="8px";c.style.top="20px";v=q=8}};g.onmousemove=g.ontouchmove=l=>{l=y(l);p&&(8>l.y-q?f=l:(v+=l.y-f.y,f=l,g.style.top=`${v}px`,c.style.top=
`${v+12}px`))};return{destroy:B,onChange:l=>{h.push(l)},show:()=>{g.style.top="8px";c.style.top="20px"}}};return'<div id="card" class="an f flex"><div class="ca-con flex fC"></div><div class="act">X</div></div>'});stynj(":root{--wid:min(calc(33.3vw - 20px),110px,110px)}.tile{background:rgba(0,0,0,.3);border-radius:12px;display:flex}.tile.sq{width:var(--wid);height:var(--wid);margin:5px 0;position:relative}.tile.sq>span{width:calc(var(--wid) - 1px);max-height:90px;top:10px;position:absolute;right:0;border-right:1px groove #fff}.tile.sq p{font-size:12px;margin:auto 21px 10px 9px;font-weight:500}");
const sa=w(function({name:b,id:a,...d}){let e=[];this.init=h=>{h.id=a;h.onclick=()=>{e.forEach(p=>p({id:a,name:b,...d}))};P("p",h).innerText=b;return{onClick:p=>{e.push(p)},destroy:()=>{e=[]}}};return'<div class="tile sq"><span></span><p>Bedroom Left</p></div>'});stynj(':root{--bord:1px solid rgba(0,0,0,0.034)}#pas{border-radius:7px;justify-content:center;max-width:400px;border:transparent;background:rgba(118,118,128,.24);margin:auto}#pas>div{padding:2px 0;flex-grow:1;text-align:center;font-size:14px;border:1px transparent}#pas>div.sel{background-color:rgba(103,103,105,.64);border-radius:7px;border:1px solid rgba(0,0,0,.14)}#pas>div:after{height:13px;content:"";display:block;position:absolute;border-left:1px solid rgba(142,142,147,.45);border-radius:.5px;transform:translate(-1px,-110%)}#pas>div:first-child:after{border-left:none}');
const ta=w(function({items:b,queries:a}){let d=0,e=[],h=[];this.init=p=>{const v=()=>{if(!(1>a.length)){a:{var f=location.search;f=f.substring(1).split("&");for(let k=0;k<f.length;k++){const g=f[k].split("=");if("tab"==g[0]){f=g[1];break a}}f=!1}f=f&&f.toLowerCase();f=a.indexOf(f);0>f&&(f=0);d!==f&&r(f)}},q=ha(v),r=f=>{E(h[d],"sel");d=f;C(h[d],"sel");e.map(k=>k(f))};b.map((f,k)=>{const g=M();g.innerText=f;k===d&&C(g,"sel");g.onclick=()=>{a[k]&&W(void 0,{tab:a[k]});r(k)};h.push(g);Q.call(p,g)});v();
return{destroy:()=>{q();e=[];d=0;h=[]},index:()=>d,onChange:f=>{e.push(f)},setIndex:f=>{a[f]&&W(void 0,{tab:a[f]});r(f)}}};return'<div id="pas" class="fw flex fR"></div>'});stynj(".toast{background-color:rgba(0,0,0,.44);box-shadow:1px 1px 8px rgba(84,84,84,.451);border-radius:10px;font-size:13px;margin:10px;height:60px;display:flex;min-width:250px;max-width:500px;position:relative;transition:bottom .5s ease-in-out;pointer-events:all;align-self:center}.tom{margin:auto}");
const ua=w(function({message:b,id:a}){let d=[];this.init=e=>{e.onclick=()=>{d.forEach(h=>h({id:a}))};P("p",e).innerText=b;return{onClick:h=>{d.push(h)},destroy:()=>{d=[]}}};return'<div class="toast"><p class="tom"></p></div>'});stynj(".tc{display:flex;position:absolute;top:0;flex-flow:column-reverse;pointer-events:none;height:calc(100% - 50px);padding-bottom:50px}");
const va=w(function(){let b=0,a=[];this.init=d=>({destroy:()=>{a.map(e=>e.destroy());a=[];b=0},pushToast:(e,h,p,v)=>{h&&console.error(e);const q=()=>{f.node.style.bottom=`-${50+200*(a.length+1)}px`},r=()=>{q();setTimeout(()=>{f.node.remove()},500)},f=ua({message:e,isError:h,id:b++});q();f.onClick(r);a.push(f);Q.call(d,f.node);setTimeout(()=>{f.node.style.bottom="0px";!p&&setTimeout(r,v||h?5E3:2500)})}});return'<div id="toc" class="fw tc"></div>'}),wa={gen:{deviceName:"WBlinds",mdnsName:"WBlinds",
emitSync:!1},hw:{pStep:19,pDir:18,pEn:13,pSleep:21,pReset:3,pMs1:1,pMs2:5,pMs3:17,pHome:4,cLen:1650,cDia:.1,axDia:15,stepsPerRev:200,res:16},mqtt:{enabled:!1,host:"192.168.0.99",port:1833,topic:"wblinds",user:"user"}},xa={state:{pos:0,tPos:0,accel:0,speed:0},settings:U({},wa),pendingState:U({},wa),devices:{},presets:{}};
class ya{constructor(){this._observers={};this._state=U({},xa);const b={};Object.keys(this._state).map(a=>{b[a]=!1});this._loadedKeys={...b};this._savingKeys={...b}}get(b){b=b.split(".");let a=this._state;for(;0<b.length;){if("object"!==typeof a)return;a=a[b.shift()]}return a}set(b,a){b=b.split(".");const d=b.pop();let e=this._state;for(;0<b.length;){if("object"!==typeof e)return;e=e[b.shift()]}e[d]=a}isLoaded(b){return this._loadedKeys[b]}setSaving(b,a){this._savingKeys[b]=a}isSaving(b){return this._savingKeys[b]}update(b,
a){this._observers[b]=this._observers[b]||[];const d=this._state[b];this._state[b]=U({},d,fa(a));this._loadedKeys[b]=!0;this._observers[b].forEach(e=>{e({value:{...a},prev:d})})}observe(b,a){this._observers[b]=this._observers[b]||[];this._observers[b].push(a);this._loadedKeys[b]&&a({value:U({},this._state[b]),prev:void 0})}}const Z=new ya;stynj(".dt{justify-content:space-between}.pt>.sq{height:50px;width:auto;min-width:150px}.pt>.sq>span{display:none}#hlc>h2{-webkit-margin-after:.1em;margin-block-end:.1em;-webkit-margin-before:.5em;margin-block-start:.5em;font-size:16px;padding-left:5px}");
const za=w(function(){let b=!0,a=[],d=[],e;this.init=()=>{const h=()=>{if(b){var f=O("hl"),k=O("hlc");f.style.display="none";E(k,"hide");b=!1}},p=f=>{f=O(`${f}-tiles`);return{container:f,tiles:f.querySelectorAll("div")}},v=f=>{const {container:k,tiles:g}=p(f);f=Math.floor(k.clientWidth/110);let t=g.length;for(;0!==t%f;){const m=M();C(m,"tile","sq","em");Q.call(k,m);t++}},q=(f,k)=>{"device"===f&&d.forEach(g=>g(k))},r=(f,k)=>{const {container:g,tiles:t}=p(f);t.forEach(m=>{const {id:c}=m;c.endsWith(e)||
c in k?k[c]=void 0:m.remove()});for(const [m,c]of Object.entries(k)){if(!c)continue;const n=sa({id:`tile-${m}`,name:c.name||m,...c});n.onClick(x=>q(f,x));a.push(n);Q.call(g,n.node)}v(f)};G(()=>{Z.observe("presets",({value:f})=>{h();r("preset",f)});Z.observe("state",({value:f})=>{e=Z.get("settings.gen.deviceName");h();const k=Z.get("settings.gen"),g=Z.get("state");r("device",{[k.deviceName]:{...k,...f,...g}})});Z.observe("devices",({value:f})=>{h();r("device",f)})});return{onDeviceClick:f=>{d.push(f)},
destroy:()=>{d=[];a.forEach(f=>f.destroy());a=[]}}};return'<div id="h" class="f flex"><div id="hl" class="loader"></div><div id="hlc" class="hide fw" style="text-align: left;"><h1 id="ht">WBlinds</h1>\x3c!-- <h4 class="hst">Presets</h4> --\x3e<div id="preset-tiles" class="pt fw flex wrap"></div><h2 class="hst">Devices</h2><div id="device-tiles" class="dt fw flex wrap"></div></div></div>'});stynj("#stcc{display:flex}#stcc>span{margin:auto}#stcc>span:last-child{margin-bottom:70px}#stcc>div{justify-content:center}#slc-act{position:fixed;bottom:55px;justify-content:space-evenly;left:0}");
stynj(".calib-btn{margin-top:40px}#calib-c,#calib-x{position:fixed;left:100%;transition:left .4s ease-in-out;top:0}#calib-c{background:url(https://github.com/maxakuru/WBlinds/blob/main/public/bg.jpg?raw=true),#000;background-position:50%;background-size:cover;overflow:hidden}#calib-c>div{width:100vw;height:100vh}#calib-c>div>h2{margin:80px 30px 10px}#calib-c>div>p{font-size:13px;margin:5px 30px 10px}#calib-x{margin:10px;width:90px;transition-delay:0s;transition-duration:.4s}.cal-conc{margin:20px auto;max-width:300px;display:flex;flex-wrap:wrap}");
const Aa=[{t:"Find home position",d:"Move to the fully open position then tap 'Done'. \nBe careful not to wind the cord too tight."},{t:"Find closed position",d:"Move to the fully closed position then tap 'Done'"},{o:!0,t:"Repeat",d:"Alternate between open and closed, tap the corresponding button in between. Repeat as many times as you like. \n\nDue to the differences in how the cord may wrap around the axis, this may or may not be needed."}],Ba=w(function(){let b,a,d=!1,e=[],h,p=0;const v=window.wblinds.tc,
q=(k,g,t)=>{var m=L("div");C(m,"fC");var c=L("h2");c.innerText=`${g+1}. ${k.t}`;Q.call(m,c);c=L("p");c.innerText=`${k.d}`;Q.call(m,c);var n=L("div");n.style.height="90%";C(n,"fC");Q.call(m,n);c=L("div");C(c,"fR");Q.call(m,c);const x={div:m,c:n};m=B=>async()=>{const y=B?"preNext":"preBack";try{x[y]&&await x[y]()}catch(l){v.pushToast(`"[Calib] Error in pre: ${l}"`)}p+=B?1:-1;h.style.left=`-${I.innerWidth*p}px`};0<g&&(n=L("button"),n.innerText="Back",Q.call(c,n),n.onclick=m(!1));const u=L("button"),
A=g===t-1?"Done":"Next";k.o||(u.disabled=!0);x.showNext=B=>{B?(u.innerText="",B=L("div"),C(B,"loader"),Q.call(u,B)):(u.innerText=A,u.disabled=!1)};u.innerText=A;u.onclick=m(!0);Q.call(c,u);return x},r=()=>{const k=L("div");C(k,"cal-conc");["speed \u25b2","move \u25b2","speed \u25bc","move \u25bc"].forEach(g=>{const t=L("button");t.innerText=g;-1<g.indexOf("up")?C(t,"btn-up"):C(t,"btn-down");Q.call(k,t)});return k},f=()=>{Aa.forEach((k,g)=>{const t=q(k,g,Aa.length);k=r();Q.call(t.c,k);k=L("button");
k.innerText="Done";Q.call(t.c,k);k.onclick=async()=>{t.showNext(!0);setTimeout(()=>{t.showNext()},4E3)};Q.call(h,t.div)});h.style.width=`${I.innerWidth*Aa.length}px`;h.style.left="0";b.style.left="0"};this.init=k=>{h=P("div",k);const g=aa("button",k);a=g.item(0);b=g.item(1);a.onclick=()=>{d||(d=!0,E(b,"hide"),E(h,"hide"),G(f))};b.onclick=()=>{const t=.2*(p+1);h.style.transitionDuration=`${t}s`;b.style.transitionDelay=`${.2*(p-.5)}s`;b.style.transitionDuration="0.2s";h.style.left=`${I.innerWidth}px`;
b.style.left=`${I.innerWidth}px`;setTimeout(()=>{p=0;h.style.transitionDuration="0.4s";b.style.transitionDuration="0.4s";b.style.transitionDelay="0s";h.innerHTML="";C(h,"hide");d=!1},1E3*t)};return{destroy:()=>{e=[];k.remove()},setDisabled:t=>{a.disabled=t},onSave:t=>{e.push(t)}}};return'<div class="f fC"><button class="calib-btn">Calibrate</button><div id="calib-c" class="hide fR"></div><button id="calib-x" class="btn-t hide">&lt; cancel</button></div>'}),Ca={gen:{ssid:{t:1,l:"SSID",g:0},pass:{t:4,
l:"Password",g:0},deviceName:{t:1,l:"Device name",g:0},mdnsName:{t:1,l:"mDNS Name",g:0},emitSync:{t:2,l:"Emit sync data"}},hw:{axDia:{l:"Axis diameter",g:2,u:"mm"},cDia:{l:"Cord diameter",g:2,u:"mm"},cLen:{l:"Cord length",g:2,u:"mm"},pDir:{l:"Direction pin",g:1},pEn:{l:"Enable pin",g:1},pHome:{l:"Home switch pin",g:1},pMs1:{l:"Microstep pin 1",g:1},pMs2:{l:"Microstep pin 2",g:1},pMs3:{l:"Microstep pin 3",g:1},pReset:{l:"Reset pin",g:1},pSleep:{l:"Sleep pin",g:1},pStep:{l:"Step pin",g:1},stepsPerRev:{l:"Steps/revolution",
g:2},res:{t:3,l:"Resolution",g:2,o:[{l:"1",v:1},{l:"1/2",v:2},{l:"1/4",v:4},{l:"1/8",v:8},{l:"1/16",v:16}]}},mqtt:{enabled:{t:2,l:"Enabled",g:3,cg:!0},host:{t:1,l:"Host",g:3},port:{l:"Port",g:3},topic:{t:1,l:"Topic",g:3},user:{t:1,l:"Username",g:3},pass:{t:4,l:"Password",g:3}}},Da=w(function(){let b=!0,a=!1,d=!1,e=[],h=[],p=[];const v=[],q=["General","Hardware","MQTT"],r=Object.keys(Ca);let f,k,g,t,m;this.init=()=>{const n=ta({items:q,queries:r}),x=y=>{const l=O("stcc");if(l){var D;0===y?D=f:1===
y?D=k:2===y&&(D=g);l.innerHTML="";Q.call(l,D)}else t=()=>x(y)};n.onChange(x);const u=()=>{if(b||a)if(b||!Z.isSaving("settings")){var y=O("sl"),l=O("slc");y.style.display="none";E(l,"hide");l.prepend(n.node);b=!1;a&&A(!1);y=O("stcc");y||(y=M(),y.id="stcc",Q.call(l,y));f=B(r[0]);m=Ba();Q.call(f,m.node);k=B(r[1]);g=B(r[2]);if(!t)return n.setIndex(n.index());t();t=void 0}};G(()=>{Z.observe("settings",()=>{u()})});const A=y=>{y!==d&&(a=!1,d=y,m&&m.setDisabled(d),y=O("slc-act"),d?(O("s-save").onclick=()=>
{a=!0;e.map(l=>l())},O("s-can").onclick=()=>{a=!0;h.map(l=>l());u()},E(y,"hide")):C(y,"hide"))},B=y=>{const l=L("span"),D=[],J=(F,K)=>{if(null==F)return Q.call(l,K.node);if(null==D[F]){const N=M();C(N,"igroup");D[F]=[N,[]];Q.call(l,N)}D[F][1].push(K);Q.call(D[F][0],K.node)};for(const F in Ca[y]){const {g:K,cg:N,l:X,t:R=0,o:Ha,u:Ia}=Ca[y][F],Ja=`${"pendingState"}.${y}.${F}`,T=oa({label:X,type:R,enumOpts:Ha,value:Z.get(`${"settings"}.${y}.${F}`),unit:Ia});J(K,T);const Ka=p.push(T);T.onChange(ma=>{N&&
c(ma,T,D[K][0],D[K][1]);v[Ka]=T.isDirty();A(0<v.filter(La=>!0===La).length);Z.set(Ja,ma)})}return l};return{destroy:()=>{n.destroy();p.forEach(y=>y.destroy());p=[];e=[];h=[]},onCancel:y=>{h.push(y)},onSave:y=>{e.push(y)}}};const c=(n,x,u,A)=>{n?E(u,"disabled"):C(u,"disabled");A.forEach(B=>{x!==B&&B.setDisabled(!n)})};return'<div id="ps" class="f fC"><div id="sl" class="loader"></div><div id="slc" class="hide fw" style="text-align: left;"><div id="slc-act" class="fR fw hide"><button id="s-can" class="btn-c">Cancel</button> <button id="s-save" class="btn-s">Save</button></div></div></div>'}),
Fa=(b,a,d)=>Ea(b,a,d),Ea=(b,a,d,e)=>{e=e||0;d=d||{};a=a||"GET";const h=S(d.body)?JSON.stringify(d.body):d.body,p={...(d.headers||{})};h&&(p["content-type"]="application/json");const v=`${"/api"}/${b}`;return fetch(v,{body:h,method:a,headers:p}).then(q=>{if(!q.ok){e+=1;if(8<e||500>q.status){const r=Error(`[${a}] ${v} failed (${q.status})`);r.response=q;throw r;}return ea(5E3*e).then(()=>Ea(b,a,d,e))}return"GET"===a?q.json():void 0})},Ga=[4,5,22,24],Ma="pos tPos speed accel deviceName mdnsName emitSyncData pinStep pinDir pinEn pinSleep pinReset pinMs1 pinMs2 pinMs3 pinHomeSw cordLength cordDiameter axisDiameter stepsPerRev resolution mqttEnabled mqttHost mqttPort mqttTopic moveUp moveDown moveStop tick".split(" "),
Na=(b={})=>{let a,d=!1,e=0;const {onMessage:h,onDisconnect:p,onConnect:v,onError:q}=b,r=!!q,f=!!v,k=!!h,g=!!p,t=()=>{a=new WebSocket(`ws://${location.hostname}/ws`);a.onopen=m=>{d=!0;e=0;f&&v(m,e)};a.onclose=m=>{d=!1;g&&p(m,e);setTimeout(t,Math.min(5E3*++e,6E4))};a.onmessage=m=>{console.log("[ws] onMessage(): ",m,m.data);m=m.data;m.endsWith("/")&&(m=m.substr(0,m.length-1));var c=m.split("/");m=c.shift();parseInt(c.shift());const n=parseInt(c.shift());n.toString(2).split("1").length-1!==c.length&&
r&&q("Event flags and data don't match",0);const x={},u={};let A=1;for(let B=0,y=Ma.length;B<y&&0<c.length;B++){if(A&n){const l=Ma[B],D=c.shift();4>B?x[l]=parseInt(D):u[l]=B in Ga?D:parseInt(D)}A<<=1}c=[];0<Object.keys(x).length&&c.push({type:0,mac:m,data:x});0<Object.keys(u).length&&c.push({type:1,mac:m,data:u});console.log("[ws] onMessage() unpacked: ",c);k&&c.forEach(h)};a.onerror=m=>{d=!1;r&&q(m,e)}};t();return{ws:a,push:(m,c)=>{if(d){var n=c.mac;var x=0===m?[c.pos,c.tPos,c.speed,c.accel]:2===
m?[c.moveBy,c.stop]:[];a:{switch(m){case 0:const A=[];c="";for(var u in x){const B=x[u];null!=B?(c+=`${B}/`,A.push(1)):A.push(0)}u=parseInt(A.reverse().join(""),2);m=`${n}/${m}/${u}/${c}`;break a;default:r?q("Unexpected event type",0):console.error("Unexpected event type")}m=void 0}a.send(m)}}}},Oa=b=>{const a=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("fill","currentColor");d.setAttribute("d",b.data);
a.setAttribute("viewBox",b.box);Q.call(a,d);a.style.width=`${b.w}px`;return a},Pa=Oa({data:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z",
box:"0 0 576 512",w:22}),Qa=Oa({data:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z",box:"0 0 512 512",w:20}),Ra=Oa({data:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z",
box:"0 0 512 512",w:20});stynj(".ic-w{width:22px}.ic{height:16px;width:16px}.ic-home{background:url(home.svg)}#bg{background-image:url(bg-0.0.1.jpg),linear-gradient(40deg,#1d0143,#293b7c,#300a52)}#bg>#_fr{display:none}.overlay{position:fixed;height:100%;width:100%;top:0;left:0;background-color:#333;font-size:24px;display:flex;align-items:center;justify-content:center;z-index:11;opacity:.95;transition:.7s;pointer-events:none}button{width:110px;height:45px;font-size:11px;text-transform:uppercase;letter-spacing:2.5px;margin:20px auto;font-weight:500;color:#000;background:rgba(240,248,255,.8);border:1px solid rgba(202,218,232,.2);border-radius:45px;box-shadow:0 8px 15px rgb(0 0 0/10%);transition:all .3s ease 0s;cursor:pointer;outline:none;position:relative}button.btn-t{border:none;background:none;color:#fff}button:active:not(:disabled,.btn-t){background-color:#2a637a;box-shadow:0 15px 20px rgba(42,99,122,.44313725490196076);color:#fff}button:active.btn-s{background-color:#2ee59d;box-shadow:0 15px 20px rgba(46,229,156,.44313725490196076)}button:active.btn-c{background:#ff5656;box-shadow:0 15px 20px rgba(255,86,86,.4)}@media (hover:hover) and (pointer:fine){button:hover:not(:disabled,.btn-t){transform:translateY(-7px);background-color:#2a637a;box-shadow:0 15px 20px rgba(42,99,122,.44313725490196076);color:#fff}button:hover.btn-s{background-color:#2ee59d;box-shadow:0 15px 20px rgba(46,229,156,.44313725490196076)}button:hover.btn-c{background:#ff5656;box-shadow:0 15px 20px rgba(255,86,86,.4)}}button:disabled{opacity:1%}button>div.loader{transform:translate3d(0,-17px,0);font-size:7px}#app{flex-direction:column;padding:23px 23px 0;height:calc(100% - 73px);overflow-y:scroll}#app,ul{display:flex}ul{list-style-type:none;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;-webkit-padding-start:0;padding-inline-start:0}li{display:list-item;text-align:-webkit-match-parent;color:hsla(0,0%,100%,.44)}li.s{color:#db8b1d}");
const Sa=[{t:"Home",i:Pa},{t:"Routines",i:Qa},{t:"Settings",i:Ra}];
var run=b=>{function a(){Z.setSaving("settings",!0);const c=da(Z._state.settings,Z._state.pendingState);Fa("settings","PUT",{body:c}).then(()=>{Z.setSaving("settings",!1);var n=Z.update,x=Z._state.pendingState;x?.gen?.pass&&(x.gen.pass=void 0);x?.mqtt?.pass&&(x.mqtt.pass=void 0);n.call(Z,"settings",x);k.pushToast("Settings saved")}).catch(n=>{k.pushToast("Failed to save settings");throw n;})}function d(){Z.update("pendingState",Z._state.settings)}function e(c){c=ra(c);Q.call(v,c.node);c.onChange(n=>
{g.push(0,n)});setTimeout(c.show)}function h(c,n,x=[]){n=n||[c];return Ea(c,void 0,void 0).then(u=>{n.forEach(A=>Z.update(A,u));x.forEach(A=>Z.set(A,u));return u}).catch(p)}function p(c){c=S(c)?(c?.message||"Error encountered, check console")+"\n"+c.stack:c;k.pushToast(c,!0)}console.log("onLoad(): ",b);O("favicon").href="favicon.ico";const v=P("body"),q=O("app");let r=-1,f;b.state=Z;const k=va();b.tc=k;Q.call(v,k.node);I.onerror=p;I.onpopstate=()=>{m(location.pathname);{const c=location.search;c!==
ja&&(ja=c,ia())}};const g=Na({onMessage(c){1===c.type&&Z.update("settings",{...Z.get("settings"),...c.data});0===c.type&&Z.update("state",{...Z.get("state"),...c.data})},onError(c,n){n||k.pushToast("Websocket disconnected!",!0,!1,5E3)},onConnect(c,n){n&&k.pushToast("Websocket connected!")},onDisconnect(){}}),t=ka({labels:Sa});ca(O("nav"),t.node);t.onClick(function(c){if(r!==c){var n=0<c?`/${Sa[c].t.toLowerCase()}`:"/";r=c;f?.destroy?.();f?.node.remove();switch(c){case 0:c=za();W(n,void 0,!0);c.onDeviceClick(e);
f=c;break;case 1:W(n,void 0,!0);f=null;break;case 2:c=Da(),W(n,void 0,!1),c.onSave(a),c.onCancel(d),f=c,Z.isLoaded("settings")||h("settings",["pendingState","settings"])}f&&Q.call(q,f.node)}});const m=c=>{c=Sa.map(n=>n.t.toLowerCase()).indexOf(c.substr(1));0>c&&(c=0);t.setIndex(c)};m(location.pathname)};export{run,Z as s}

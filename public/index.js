function m(b){return(...a)=>{var c={};a=b.call(c,...a);a=(new DOMParser).parseFromString(a,"text/html").getElementsByTagName("body").item(0).firstChild;c=c.init(a);c.node=a;return c}}
function r(b,a){void 0===a&&(a={});a=a.insertAt;if(b&&"undefined"!==typeof document){var c=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";"top"===a?c.firstChild?c.insertBefore(d,c.firstChild):c.appendChild(d):c.appendChild(d);d.styleSheet?d.styleSheet.cssText=b:d.appendChild(document.createTextNode(b))}}r("#nav{background:rgba(0,0,0,.5);height:50px;display:flex;font-size:14px;justify-content:center}.navc{justify-content:space-around;align-self:center;max-width:500px}.navc .sel{color:#db8b1d}#nav>ul>li>.l{-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;font-size:8px}");
function u(b,...a){b.classList.add(...a)}function w(b,...a){b.classList.remove(...a)}
let y=setTimeout,z=document,A=window,B=z.createElement.bind(z),C=z.createElement.bind(z,"div"),D=z.getElementById.bind(z),aa=(b,a=z)=>a.getElementsByTagName.call(a,b),F=(b,a=z)=>a.querySelector.call(a,b),ba=b=>b.stopPropagation(),fa=(b,a)=>G.call(b,a),G=z.appendChild,J=b=>b&&"object"===typeof b&&!Array.isArray(b),K=(b,...a)=>{if(!a.length)return b;const c=a.shift();if(J(b)&&J(c))for(const a in c)J(c[a])?(b[a]||Object.assign(b,{[a]:{}}),K(b[a],c[a])):Object.assign(b,{[a]:c[a]});return K(b,...a)},M=
(b,a)=>Object.keys(a).reduce((c,d)=>b[d]===a[d]||null==a[d]?c:J(b[d])&&J(a[d])?{...c,[d]:M(b[d],a[d])}:{...c,[d]:a[d]},{}),ha=b=>new Promise(a=>{setTimeout(a,b)}),ia=b=>{const a={};for(const c in b)null!=b[c]&&(a[c]=b[c]);return a},N=[],ja=b=>{const a=N.push(b);return()=>{console.log("delete: ",N,a,N[a-1]);delete N[a-1]}},O=()=>{N.forEach(b=>{b&&b()})},P=location.search,Q=(b,a,c)=>{a=a||{};null==c&&(c=!0);const d=location.pathname,e=location.search;c=new URLSearchParams(c?"":e);for(const b in a)c.set(b,
a[b]);a=c.toString();0<a.length&&(a="?"+a);if(b!==d||a!==e)history.pushState(null,"",(b||d)+a),a!==e&&O()},ka=m(function({labels:b}){let a=0,c=[];const d=[];this.init=e=>{const l=b=>{a=b;d.forEach((b,c)=>{c===a?u(b,"sel"):w(b,"sel")});c.map(a=>a(b))};b.map((b,c)=>{const g=B("li");u(g,"fC");c===a&&u(g,"sel");var f=B("i");G.call(f,b.i);G.call(g,f);f=B("p");u(f,"l");f.innerText=b.t;G.call(g,f);d.push(g);G.call(e,g);g.onclick=()=>l(c)});return{onClick:a=>{c.push(a)},currentIndex:()=>a,destroy:()=>{c=
[]},setIndex:l}};return'<ul class="fw navc"></ul>'});r(":root{--oc:#1d95db;--cc:#606060}.sc{pointer-events:none;padding:20px;align-self:center;align-items:center;justify-content:center;height:59%;overflow-x:hidden;width:50vh}.slider{pointer-events:all;transform:rotate(90deg);background:linear-gradient(90deg,var(--cc) 0,var(--cc) 50%,var(--oc) 0,var(--oc));height:7px;outline:none;border-radius:15px;height:150px;-webkit-appearance:none;-moz-appearance:none;appearance:none;width:400px}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:30px;transform:translateX(-15px);height:70px;background:transparent;border-right:2px solid #fff;box-shadow:#000;cursor:pointer}");
let R=(b,a,c,d,e,l)=>{a=(a-c)/(d-c)*100;b.style.background=`linear-gradient(to right, ${e} 0%, ${e} ${a}%, ${l} ${a}%, ${l} 100%`},la=m(function({value:b}){let a=[];this.init=c=>{const d=F("input",c);d.onmousedown=d.ontouchstart=ba;const e=parseInt,l=e(d.min),n=e(d.max);d.oninput=()=>{const a=e(d.value);R(d,a,l,n,"#606060","#1d95db")};d.onchange=()=>{const b=e(d.value);a.forEach(a=>a(b))};d.value=`${b}`;R(d,b,l,n,"#606060","#1d95db");return{destroy:()=>{a=[]},onChange:b=>{a.push(b)}}};return'<div class="sc flex"><input class="slider" type="range" min="0" max="100"></div>'});
r('#card{position:fixed;top:100%;background:rgb(9 9 9/88%);border-radius:30px 30px 0 0;text-align:left;justify-content:center;font-size:12px}#card:after{content:"-";transform:scaleX(20) translate(.5px);position:fixed;color:var(--cc)}#card.an,#card>.an{transition:top .2s ease-in-out}.ca-con{width:80%;max-width:300px;padding-top:50px}.cR{margin-bottom:50px}#card .act{position:fixed;right:18px;top:100%;font-size:20px;font-weight:100;transform:scaleX(1.3)}');r(':root{--c:#1d95db}.in{justify-content:space-between;height:50px;align-items:center;background:rgba(0,0,0,.56);padding:0 0 0 15px;border-radius:15px;min-width:300px;font-size:14px}.in.disabled{color:grey}.in>label{font-weight:700}.igroup>.in{margin-top:0;border-radius:0;border-bottom:1px solid hsla(0,0%,100%,.30196078431372547)}.igroup>.in:first-child{border-radius:15px 15px 0 0;margin-top:20px}.igroup>.in:last-child{border-radius:0 0 15px 15px;margin-bottom:20px;border-bottom:none}.in-r{background:linear-gradient(90deg,var(--c) 0,var(--c) 50%,#606060 0,#606060);border-radius:8px;height:7px;width:75%;border-radius:15px;height:6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;outline:none}.in-r::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:#fff;box-shadow:#000;border-radius:50%;cursor:pointer}.in>input:not([type=checkbox]),.in>select{flex-grow:1;padding:10px 27px 10px 0;background:transparent;border:none;color:#db8b1d;-moz-text-align-last:right;text-align-last:right;-webkit-appearance:none;-moz-appearance:none;text-align:right}.in>select+span{left:-10px;transform:scale(1.6,.9) translateY(-1px);font-weight:200;color:#db8b1d}.in>span{color:#5f5f5f;position:relative;font-size:12px;pointer-events:none;margin-left:-20px;left:-5px}.in>select{margin-inline:12px}.in:focus-within{box-shadow:inset -1px 0 rgba(219,139,29,.627)}.in>input:is([type=checkbox]){margin-right:15px}.in>input:disabled{color:grey}input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:51px;height:31px;border-radius:50px;background-color:rgba(148,148,154,.2)!important}[type=checkbox]:after{content:"";width:50%;border-radius:100%;height:80%;display:block;position:relative;background-color:#fff;top:12%;left:3%;transition:left .2s ease-in-out}[type=checkbox].on{background-color:#34c759!important}[type=checkbox].on:after{left:45%}');
let ma={1:"text",2:"checkbox",0:"number",3:"select",4:"password",5:"range"},na=m(function({label:b,type:a,enumOpts:c,placeholder:d,value:e,unit:l,embed:n=!0,prevDefault:q=!1,min:g,max:f}){let t=e,k,x=[];const h=h=>{function p(a){""===a&&(a=void 0);t=a;x.forEach(a=>a(t))}h.innerHTML="";n&&u(h,"in");var v=B("label");v.innerText=b;G.call(h,v);3===a?(k=B("select"),u(h,"in-s"),c.forEach(a=>{const b=B("option");b.value=a.v;b.innerText=a.l;G.call(k,b)}),k.onchange=a=>{q&&a.preventDefault();p(c[k.options.selectedIndex].v)}):
(k=B("input"),k.type=ma[a],k.placeholder=d||"xxxxx",null!=g&&(k.min=`${g}`),null!=f&&(k.max=`${f}`),5===a&&u(k,"in-r"),2===a?((k.checked=e)&&u(k,"on"),k.onchange=a=>{q&&a.preventDefault();k.classList.toggle("on");p(k.checked)}):k.onchange=a=>{q&&a.preventDefault();p(k.value)});null!=e&&(k.value=e);k.id=v.htmlFor=`in-${b.split(" ").join("-")}`;G.call(h,k);if(3===a||l)v=B("span"),v.innerText=l?l:"v",G.call(h,v)};this.init=a=>{h(a);return{onChange:a=>{x.push(a)},setDisabled:b=>{a.classList.toggle("disabled");
k.disabled=b},destroy:()=>{x=[]},reset:()=>{h(a)},isDirty:()=>e!==t}};return'<div class="fR"></div>'}),oa=["Speed","Acceleration"],pa=[[1,5E3],[1,4294967294]],qa=m(function({tPos:b,pos:a,accel:c,speed:d,ip:e,name:l}){let n=[],q=!1,g=0,f=0,t=!1,k={},x=[];this.init=h=>{function E(a){null==a&&(a=!1);a!==t&&(a?u(h,"an"):w(h,"an"),a?u(v,"an"):w(v,"an"),t=a)}const p=F(".ca-con",h),v=F(".act",h);E(!0);console.log("card data: ",b,a,c,d,e,l);const I=a=>{n.forEach(b=>b(a))},L=a=>{const b=0===a?d:c,f=na({type:5,
label:oa[a],value:b,embed:!1,min:pa[a][0],max:pa[a][1]}),g=F("input",f.node);w(f.node,"fR");u(f.node,"cR");const e=parseInt,t=e(g.min),k=e(g.max);g.oninput=()=>{const a=e(g.value);R(g,a,t,k,"#1d95db","#606060")};f.onChange(b=>{0===a?I({speed:b}):1===a&&I({accel:b})});G.call(p,f.node);R(g,b,t,k,"#1d95db","#606060");x.push(f)};L(0);L(1);const H=la({value:a});H.onChange(a=>{I({tPos:a})});G.call(p,H.node);const da=()=>{E(!0);h.ontransitionend=ca;const a=h.clientHeight;h.style.top=`${a}px`;v.style.top=
`${a+8}px`};v.onclick=da;const ca=()=>{n=[];H.destroy();x.forEach(a=>a.destroy());x=[];h.remove()},ea=a=>{let {x:b,y:c}=a;null==b&&(b=a.touches[0].clientX,c=a.touches[0].clientY);return{x:b,y:c}};h.onmousedown=h.ontouchstart=a=>{k=a=ea(a);f=a.y;q=!0;E(!1)};h.onmouseup=h.onmouseout=h.ontouchend=()=>{if(q){q=!1;E(!0);if(g>h.clientHeight/2)return da();h.style.top="8px";v.style.top="16px";g=f=8}};h.onmousemove=h.ontouchmove=a=>{a=ea(a);q&&(8>a.y-f?k=a:(g+=a.y-k.y,k=a,h.style.top=`${g}px`,v.style.top=
`${g+8}px`))};return{destroy:ca,onChange:a=>{n.push(a)},show:()=>{h.style.top="8px";v.style.top="16px"}}};return'<div id="card" class="an f flex"><div class="ca-con flex fC"></div><div class="act">X</div></div>'});r(":root{--wid:min(calc(33.3vw - 20px),110px,110px)}.tile{background:rgba(0,0,0,.3);border-radius:12px;display:flex}.tile.sq{width:var(--wid);height:var(--wid);margin:5px 0;position:relative}.tile.sq>span{width:calc(var(--wid) - 1px);max-height:90px;top:10px;position:absolute;right:0;border-right:1px groove #fff}.tile.sq p{font-size:11px;margin:auto 21px 10px 9px;font-weight:500}");
let ra=m(function({name:b,id:a,...c}){let d=[];this.init=e=>{e.id=a;e.onclick=()=>{d.forEach(d=>d({id:a,name:b,...c}))};F("p",e).innerText=b;return{onClick:a=>{d.push(a)},destroy:()=>{d=[]}}};return'<div class="tile sq"><span></span><p>Bedroom Left</p></div>'});r(':root{--bord:1px solid rgba(0,0,0,0.034)}#pas{border-radius:7px;justify-content:center;border:transparent;background:rgba(118,118,128,.24)}#pas>div{padding:2px 0;flex-grow:1;text-align:center;font-size:14px;border:1px transparent}#pas>div.sel{background-color:rgba(103,103,105,.64);border-radius:7px;border:1px solid rgba(0,0,0,.14)}#pas>div:after{height:13px;content:"";display:block;position:absolute;border-left:1px solid rgba(142,142,147,.45);border-radius:.5px;transform:translate(-1px,-110%)}#pas>div:first-child:after{border-left:none}');
let sa=m(function({items:b,queries:a}){let c=0,d=[],e=[];this.init=l=>{const n=()=>{if(!(1>a.length)){a:{var b=location.search;b=b.substring(1).split("&");for(let a=0;a<b.length;a++){const c=b[a].split("=");if("tab"==c[0]){b=c[1];break a}}b=!1}b=b&&b.toLowerCase();b=a.indexOf(b);console.log("handleQueryChange: ",b);0>b&&(b=0);c!==b&&g(b)}},q=ja(n),g=a=>{w(e[c],"sel");c=a;u(e[c],"sel");d.map(b=>b(a))};b.map((b,d)=>{const f=C();f.innerText=b;d===c&&u(f,"sel");f.onclick=()=>{a[d]&&Q(void 0,{tab:a[d]});
g(d)};e.push(f);G.call(l,f)});n();return{destroy:()=>{q();d=[];c=0;e=[]},index:()=>c,onChange:a=>{d.push(a)},setIndex:b=>{a[b]&&Q(void 0,{tab:a[b]});g(b)}}};return'<div id="pas" class="fw flex fR"></div>'});r(".toast{background-color:rgba(0,0,0,.44);box-shadow:1px 1px 8px rgba(84,84,84,.451);border-radius:10px;font-size:13px;margin:10px;height:60px;display:flex;min-width:250px;max-width:500px;position:relative;transition:bottom .5s ease-in-out;pointer-events:all;align-self:center}.tom{margin:auto}");
let ta=m(function({message:b,id:a}){let c=[];this.init=d=>{d.onclick=()=>{c.forEach(b=>b({id:a}))};F("p",d).innerText=b;return{onClick:a=>{c.push(a)},destroy:()=>{c=[]}}};return'<div class="toast"><p class="tom"></p></div>'});r(".tc{display:flex;position:absolute;top:0;flex-flow:column-reverse;pointer-events:none;height:calc(100% - 50px);padding-bottom:50px}");
let ua=m(function(){let b=0,a=[];this.init=c=>({destroy:()=>{a.map(a=>a.destroy());a=[];b=0},pushToast:(d,e,l,n)=>{const q=()=>{f.node.style.bottom=`-${50+200*(a.length+1)}px`},g=()=>{q();setTimeout(()=>{f.node.remove()},500)},f=ta({message:d,isError:e,id:b++});q();f.onClick(g);a.push(f);G.call(c,f.node);setTimeout(()=>{f.node.style.bottom="0px";!l&&setTimeout(g,n||e?5E3:2500)})}});return'<div id="toc" class="fw tc"></div>'}),va={gen:{deviceName:"WBlinds",mdnsName:"WBlinds",emitSync:!1},hw:{pStep:19,
pDir:18,pEn:13,pSleep:21,pReset:3,pMs1:1,pMs2:5,pMs3:17,pHome:4,cLen:1650,cDia:.1,axDia:15,stepsPerRev:200,res:16},mqtt:{enabled:!1,host:"192.168.0.99",port:1833,topic:"wblinds",user:"user"}},wa={state:{pos:0,tPos:0,accel:0,speed:0},settings:K({},va),pendingState:K({},va),devices:{},presets:{}};
class xa{constructor(){this._observers={};this._state=K({},wa);let b={};Object.keys(this._state).map(a=>{b[a]=!1});this._loadedKeys={...b};this._savingKeys={...b}}get(b){b=b.split(".");let a=this._state;for(;0<b.length;){if("object"!==typeof a)return;a=a[b.shift()]}return a}set(b,a){b=b.split(".");let c=b.pop(),d=this._state;for(;0<b.length;){if("object"!==typeof d)return;d=d[b.shift()]}d[c]=a}isLoaded(b){return this._loadedKeys[b]}setSaving(b,a){this._savingKeys[b]=a}isSaving(b){return this._savingKeys[b]}update(b,
a){this._observers[b]=this._observers[b]||[];let c=this._state[b];this._state[b]=K({},c,ia(a));this._loadedKeys[b]=!0;this._observers[b].forEach(b=>{b({value:{...a},prev:c})})}observe(b,a){this._observers[b]=this._observers[b]||[];this._observers[b].push(a);this._loadedKeys[b]&&a({value:K({},this._state[b]),prev:void 0})}}let S=new xa;r(".dt{justify-content:space-between}.pt>.sq{height:50px;width:auto;min-width:150px}.pt>.sq>span{display:none}");
let ya=m(function(){let b=!0,a=[],c=[];this.init=()=>{const d=()=>{if(b){var a=D("hl"),c=D("hlc");a.style.display="none";w(c,"hide");b=!1}},e=a=>{a=D(`${a}-tiles`);return{container:a,tiles:a.querySelectorAll("div")}},l=a=>{const {container:b,tiles:c}=e(a);a=Math.floor(b.clientWidth/110);let d=c.length;for(;0!==d%a;){const a=C();u(a,"tile","sq","em");G.call(b,a);d++}},n=(a,b)=>{"device"===a&&c.forEach(a=>a(b))},q=(b,c)=>{const {container:d,tiles:g}=e(b);g.forEach(a=>{const {id:b}=a;b.endsWith(S.get("settings.gen.deviceName"))||
b in c?c[b]=void 0:a.remove()});for(const [g,f]of Object.entries(c)){if(!f)continue;const c=ra({id:`tile-${g}`,name:f.name||g,...f});c.onClick(a=>n(b,a));a.push(c);G.call(d,c.node)}l(b)};y(()=>{S.observe("presets",({value:a})=>{d();q("preset",a)});S.observe("state",({value:a})=>{d();const b=S.get("settings.gen"),c=S.get("state");console.log("set tile: ",b.deviceName,{...b,...a,...c});q("device",{[b.deviceName]:{...b,...a,...c}})});S.observe("devices",({value:a})=>{d();q("device",a)})});return{onDeviceClick:a=>
{c.push(a)},destroy:()=>{c=[];a.forEach(a=>a.destroy());a=[]}}};return'<div id="h" class="f flex"><div id="hl" class="loader"></div><div id="hlc" class="hide fw" style="text-align: left;"><h1 id="ht">WBlinds</h1>\x3c!-- <h4 class="hst">Presets</h4> --\x3e<div id="preset-tiles" class="pt fw flex wrap"></div><h4 class="hst">Devices</h4><div id="device-tiles" class="dt fw flex wrap"></div></div></div>'});r("#pas{margin-bottom:20px}#stcc{display:flex}#stcc>span{margin:auto}#stcc>span:last-child{margin-bottom:70px}#stcc>div{justify-content:center}#slc-act{position:fixed;bottom:55px;justify-content:space-evenly;left:0}");
r(".calib-btn{margin-top:40px}#calib-c,#calib-x{position:fixed;left:100%;transition:left .4s ease-in-out;top:0}#calib-c{background:url(https://github.com/maxakuru/WBlinds/blob/main/public/bg.jpg?raw=true),#000;background-position:50%;background-size:cover;overflow:hidden}#calib-c>div{width:100vw;height:100vh}#calib-c>div>h2{margin:80px 40px}#calib-x{margin:20px}");
let T=A.innerWidth,za=[{t:"Set speed"},{t:"Find home position"}],Aa=m(function(){let b,a,c=!1,d=[],e,l=0;const n=(a,b)=>{var c=B("div");u(c,"fC");var d=B("h2");d.innerText=`${b}. ${a.t}`;G.call(c,d);a=B("div");a.style.height="90%";G.call(c,a);d=B("div");u(d,"fR");G.call(c,d);a=B("button");a.innerText="Next";b=B("button");b.innerText="Back";G.call(d,b);G.call(d,a);const f={div:c};c=a=>async()=>{const b=a?"preNext":"preBack";try{f[b]&&await f[b]()}catch(p){console.error("[Calib] Error in pre: ",p)}l+=
a?1:-1;console.log("step index: ",l,A.screenX,T);e.style.left=`-${T*l}px`};a.onclick=c(!0);b.onclick=c(!1);return f},q=()=>{console.log("calibFlow");za.forEach((a,b)=>{a=n(a,b);G.call(e,a.div)});e.style.left="0";e.style.width=`${5*T}px`;b.style.left="0"};this.init=g=>{e=F("div",g);const f=aa("button",g);a=f.item(0);b=f.item(1);a.onclick=()=>{c||(c=!0,w(b,"hide"),w(e,"hide"),y(q))};b.onclick=()=>{const a=.2*(l+1);e.style.transitionDuration=`${a}s`;b.style.transitionDelay=`${.2*(l-.5)}s`;b.style.transitionDuration=
"0.2s";e.style.left=`${T}px`;b.style.left=`${T}px`;setTimeout(()=>{l=0;e.style.transitionDuration="0.4s";b.style.transitionDuration="0.4s";b.style.transitionDelay="0s";e.innerHTML="";u(e,"hide");c=!1},1E3*a)};return{destroy:()=>{d=[];g.remove()},setDisabled:b=>{a.disabled=b},onSave:a=>{d.push(a)}}};return'<div class="f fC"><button class="calib-btn">Calibrate</button><div id="calib-c" class="hide fR"></div><button id="calib-x" class="btn-c hide">Cancel</button></div>'}),U={gen:{ssid:{t:1,l:"SSID",
g:0},pass:{t:4,l:"Password",g:0},deviceName:{t:1,l:"Device name",g:0},mdnsName:{t:1,l:"mDNS Name",g:0},emitSync:{t:2,l:"Emit sync data"}},hw:{axDia:{l:"Axis diameter",g:2,u:"mm"},cDia:{l:"Cord diameter",g:2,u:"mm"},cLen:{l:"Cord length",g:2,u:"mm"},pDir:{l:"Direction pin",g:1},pEn:{l:"Enable pin",g:1},pHome:{l:"Home switch pin",g:1},pMs1:{l:"Microstep pin 1",g:1},pMs2:{l:"Microstep pin 2",g:1},pMs3:{l:"Microstep pin 3",g:1},pReset:{l:"Reset pin",g:1},pSleep:{l:"Sleep pin",g:1},pStep:{l:"Step pin",
g:1},stepsPerRev:{l:"Steps/revolution",g:2},res:{t:3,l:"Resolution",g:2,o:[{l:"1",v:1},{l:"1/4",v:4},{l:"1/8",v:8},{l:"1/16",v:16}]}},mqtt:{enabled:{t:2,l:"Enabled",g:3,cg:!0},host:{t:1,l:"Host",g:3},port:{l:"Port",g:3},topic:{t:1,l:"Topic",g:3},user:{t:1,l:"Username",g:3},pass:{t:4,l:"Password",g:3}}},Ba=m(function(){let b=!0,a=!1,c=!1,d=[],e=[],l=[];const n=[],q=["General","Hardware","MQTT"],g=Object.keys(U);let f,t,k,x,h;this.init=()=>{const p=sa({items:q,queries:g}),v=a=>{console.log("index: ",
a);const b=D("stcc");if(b){var c;0===a?c=f:1===a?c=t:2===a&&(c=k);b.innerHTML="";G.call(b,c)}else console.log("index2: ",a),x=()=>v(a)};p.onChange(v);const I=()=>{if(b||a)if(b||!S.isSaving("settings")){var c=D("sl"),d=D("slc");c.style.display="none";w(d,"hide");d.prepend(p.node);b=!1;a&&L(!1);c=D("stcc");c||(c=C(),c.id="stcc",G.call(d,c));f=H(g[0]);h=Aa();G.call(f,h.node);t=H(g[1]);k=H(g[2]);if(!x)return p.setIndex(p.index());console.log("calling aftet load:");x();x=void 0}};y(()=>{S.observe("settings",
()=>{I()})});const L=b=>{b!==c&&(a=!1,c=b,h&&h.setDisabled(c),b=D("slc-act"),c?(D("s-save").onclick=()=>{a=!0;d.map(a=>a())},D("s-can").onclick=()=>{a=!0;e.map(a=>a());I()},w(b,"hide")):u(b,"hide"))},H=a=>{const b=B("span"),c=[],d=(a,d)=>{if(null==a)return G.call(b,d.node);if(null==c[a]){const d=C();u(d,"igroup");c[a]=[d,[]];G.call(b,d)}c[a][1].push(d);G.call(c[a][0],d.node)};for(const b in U[a]){const {g:p,cg:e,l:f,t:g=0,o:q,u:v}=U[a][b],k=`${"pendingState"}.${a}.${b}`,h=na({label:f,type:g,enumOpts:q,
value:S.get(`${"settings"}.${a}.${b}`),unit:v});d(p,h);const t=l.push(h);h.onChange(a=>{e&&E(a,h,c[p][0],c[p][1]);n[t]=h.isDirty();L(0<n.filter(a=>!0===a).length);S.set(k,a)})}return b};return{destroy:()=>{p.destroy();l.forEach(a=>a.destroy());l=[];d=[];e=[]},onCancel:a=>{e.push(a)},onSave:a=>{d.push(a)}}};const E=(a,b,c,d)=>{a?w(c,"disabled"):u(c,"disabled");d.forEach(c=>{b!==c&&c.setDisabled(!a)})};return'<div id="ps" class="f fC"><div id="sl" class="loader"></div><div id="slc" class="hide fw" style="text-align: left;"><div id="slc-act" class="fR fw hide"><button id="s-can" class="btn-c">Cancel</button> <button id="s-save" class="btn-s">Save</button></div></div></div>'}),
Ca=(b,a,c)=>V(b,a,c),V=(b,a,c,d)=>{d=d||0;c=c||{};a=a||"GET";const e=J(c.body)?JSON.stringify(c.body):c.body,l={...c.headers||{}};e&&(l["content-type"]="application/json");const n=`${"/api"}/${b}`;return fetch(n,{body:e,method:a,headers:l}).then(e=>{if(!e.ok){d+=1;if(8<d||500>e.status){const b=Error(`[${a}] ${n} failed (${e.status})`);b.response=e;throw b;}return ha(5E3*d).then(()=>V(b,a,c,d))}return"GET"===a?e.json():void 0})},Da=[4,5,22,24],Ea="pos tPos speed accel deviceName mdnsName emitSyncData pinStep pinDir pinEn pinSleep pinReset pinMs1 pinMs2 pinMs3 pinHomeSw cordLength cordDiameter axisDiameter stepsPerRev resolution mqttEnabled mqttHost mqttPort mqttTopic moveUp moveDown moveStop tick".split(" ");
var Fa,W=Fa||(Fa={});W[W.UpdateSettings=0]="UpdateSettings";W[W.UpdateState=1]="UpdateState";
let Ga=(b={})=>{function a(a){var b=a.split("/");a=b.shift();const c=parseInt(b.shift()),d={},e={};let k=1;for(let a=0,f=Ea.length;a<f&&0<b.length;a++){if(k&c){const c=Ea[a],p=b.shift();4>a?d[c]=parseInt(p):e[c]=a in Da?p:parseInt(p)}k<<=1}b=[];0<Object.keys(d).length&&b.push({type:1,mac:a,data:d});0<Object.keys(e).length&&b.push({type:0,mac:a,data:e});return b}let c,d=!1,e=0;const l=()=>{c=new WebSocket(`ws://${location.hostname}/ws`);c.onopen=a=>{d=!0;e=0;b.onConnect&&b.onConnect(a,e)};c.onclose=
a=>{d=!1;b.onDisconnect&&b.onDisconnect(a,e);setTimeout(l,Math.min(5E3*++e,6E4))};c.onmessage=c=>{c=a(c.data);b.onMessage&&c.map(a=>b.onMessage(a))};c.onerror=a=>{d=!1;b.onError&&b.onError(a,e)}};l();return{ws:c,push:(a,b)=>{if(d){{a=[b.pos,b.tPos,b.speed,b.accel];b=[];let c="";for(e in a){const d=a[e];null!=d?(c+=`${d}/`,b.push(1)):b.push(0)}var e=`mac/${parseInt(b.reverse().join(""),2)}/${c}`}c.send(e)}}}},X=b=>{const a=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=document.createElementNS("http://www.w3.org/2000/svg",
"path");c.setAttribute("fill","currentColor");c.setAttribute("d",b.data);a.setAttribute("viewBox",b.box);G.call(a,c);a.style.width=`${b.w}px`;return a},Ha=X({data:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z",
box:"0 0 576 512",w:22}),Ia=X({data:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z",box:"0 0 512 512",w:20}),Ja=X({data:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z",
box:"0 0 512 512",w:20}),Y=[{t:"Home",i:Ha},{t:"Routines",i:Ia},{t:"Settings",i:Ja}];
var Ka=b=>{function a(){S.setSaving("settings",!0);let a=M(S._state.state,S._state.pendingState);Ca("settings","PUT",{body:a}).then(()=>{S.setSaving("settings",!1);S.update("settings",h(S._state.pendingState));t.pushToast("Settings saved")}).catch(a=>{t.pushToast("Failed to save settings");throw a;})}function c(){S.update("pendingState",S._state.settings)}function d(a){console.log("handle device click: ",a);a=qa(a);G.call(n,a.node);a.onChange(a=>{E.push(1,a)});setTimeout(a.show)}function e(a,b){b=
b||[a];return V(a,void 0,void 0).then(a=>{b.map(b=>S.update(b,a));return a}).catch(l)}function l(a){console.error(a);a=J(a)?((null===a||void 0===a?void 0:a.message)||"Error encountered, check console")+"\n"+a.stack:a;t.pushToast(a,!0)}let n=F("body"),q=D("app"),g=-1,f;b.state=S;let t=ua();G.call(n,t.node);A.onerror=l;A.onpopstate=()=>{x(location.pathname);{const a=location.search;a!==P&&(P=a,O())}};let k=ka({labels:Y});fa(D("nav"),k.node);k.onClick(function(b){var p;if(g!==b){var h=`/${Y[b].t.toLowerCase()}`;
g=b;null===(p=null===f||void 0===f?void 0:f.destroy)||void 0===p?void 0:p.call(f);null===f||void 0===f?void 0:f.node.remove();switch(b){case 0:b=ya();Q(h,void 0,!0);b.onDeviceClick(d);S.isLoaded("state")||(e("state"),e("presets"),e("devices"));f=b;break;case 1:Q(h,void 0,!0);f=null;break;case 2:b=Ba(),Q(h,void 0,!1),b.onSave(a),b.onCancel(c),f=b,S.isLoaded("settings")||e("settings",["pendingState","settings"])}f&&G.call(q,f.node)}});let x=a=>{a=Y.map(a=>a.t.toLowerCase()).indexOf(a.substr(1));0>a&&
(a=0);k.setIndex(a)};x(location.pathname);let h=a=>{var b,c;if(null===(b=null===a||void 0===a?void 0:a.gen)||void 0===b?0:b.pass)a.gen.pass=void 0;if(null===(c=null===a||void 0===a?void 0:a.mqtt)||void 0===c?0:c.pass)a.mqtt.pass=void 0;return a},E=Ga({onMessage(a){0===a.type&&S.update("settings",{...S.get("settings"),...a.data})},onError(a,b){b||t.pushToast("Websocket disconnected!",!0,!1,5E3)},onConnect(a,b){b&&t.pushToast("Websocket connected!")},onDisconnect(){}})};r(':root{--bg-img:url(https://github.com/maxakuru/WBlinds/blob/main/public/bg.jpg?raw=true)}html{touch-action:manipulation}html>*{font-family:-apple-system,BlinkMacSystemFont,helvetica,sans-serif}body{margin:0;color:#fff;text-align:center;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;scrollbar-width:6px;scrollbar-color:transparent}body,html{height:100%;width:100%;position:fixed;-ms-scroll-chaining:none;overscroll-behavior:none}:focus{outline:none}h1,h4{font-weight:400}.ic-w{width:22px}.ic{height:16px;width:16px}.ic-home{background:url(home.svg)}h1{font-size:32px}h4{-webkit-margin-after:.1em;margin-block-end:.1em;-webkit-margin-before:.5em;margin-block-start:.5em;font-size:14px;padding-left:5px}.hide{display:none!important}.loader,.loader:after,.loader:before{border-radius:50%;width:2.5em;height:2.5em;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation:load7 1.8s ease-in-out infinite;animation:load7 1.8s ease-in-out infinite}.loader{margin:auto;color:#fff;font-size:10px;text-indent:-9999em;transform:translate3d(0,-100px,0);-webkit-animation-delay:-.16s;animation-delay:-.16s;align-self:center}.loader:after,.loader:before{content:"";position:absolute;top:0}.loader:before{left:-3.5em;-webkit-animation-delay:-.32s;animation-delay:-.32s}.loader:after{left:3.5em}@-webkit-keyframes load7{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes load7{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}.em{opacity:0}ul{display:flex;list-style-type:none;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;-webkit-padding-start:0;padding-inline-start:0}li{display:list-item;text-align:-webkit-match-parent;color:hsla(0,0%,100%,.44)}li.s{color:#db8b1d}.f{width:100%;height:100%}.fC,.flex{display:flex}.fC{flex-direction:column}.fR{display:flex;flex-direction:row}.wrap{flex-wrap:wrap}.fw{width:100%}#bg{height:100vh;width:100vw;position:fixed;z-index:-10;background-position:30%;background-repeat:no-repeat;background-size:cover;opacity:1;transition:opacity 2s;background-image:var(--bg-img),linear-gradient(40deg,#1d0143,#293b7c,#300a52)}#app{display:flex;flex-direction:column;padding:23px 23px 0;height:calc(100% - 73px);overflow-y:scroll}.overlay{position:fixed;height:100%;width:100%;top:0;left:0;background-color:#333;font-size:24px;display:flex;align-items:center;justify-content:center;z-index:11;opacity:.95;transition:.7s;pointer-events:none}button{width:110px;height:45px;font-size:11px;text-transform:uppercase;letter-spacing:2.5px;margin:20px auto;font-weight:500;color:#f0f8ff;background:rgba(240,248,255,.2196078431372549);border:1px solid rgba(202,218,232,.2);border-radius:45px;box-shadow:0 8px 15px rgb(0 0 0/10%);transition:all .3s ease 0s;cursor:pointer;outline:none}button:hover:not(:disabled){background-color:#2a637a;box-shadow:0 15px 20px rgba(42,99,122,.44313725490196076);color:#fff;transform:translateY(-7px)}button:hover.btn-s{background-color:#2ee59d;box-shadow:0 15px 20px rgba(46,229,156,.44313725490196076)}button:hover.btn-c{background:#ff5656;box-shadow:0 15px 20px rgba(255,86,86,.4)}button:disabled{opacity:1%}');
var La;{var Z=window;const b=JSON.parse(Z.wblinds||"{}"),a=Z.wblinds=b;console.log("window: ",Z);La=a}window.onload=()=>Ka(La)

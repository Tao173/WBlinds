function l(b){return(...a)=>{var c={};a=b.call(c,...a);a=(new DOMParser).parseFromString(a,"text/html");console.log("ctx: ",c);a=a.getElementsByTagName("body").item(0).firstChild;c=c.init.call(c,a);c.node=a;return c}}
function m(b,a){void 0===a&&(a={});a=a.insertAt;if(b&&"undefined"!==typeof document){var c=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";"top"===a?c.firstChild?c.insertBefore(d,c.firstChild):c.appendChild(d):c.appendChild(d);d.styleSheet?d.styleSheet.cssText=b:d.appendChild(document.createTextNode(b))}}m("#nav{background:rgba(0,0,0,.5019607843137255);height:63px;display:flex}.navc{justify-content:space-evenly;align-self:center}.navc .sel{color:#db8b1d}");
let n=l(function(){let b=0,a=[];this.init=function(c){console.log("elem: ",c);const d=c.querySelectorAll("li");console.log("buttons: ",d);d.forEach((c,f)=>{c.addEventListener("click",()=>{b=f;d.forEach((a,c)=>{c===b?a.classList.add("sel"):a.classList.remove("sel")});a.map(a=>a.call(void 0,f))})});return{onClick:b=>{a.push(b)},currentIndex:()=>b,destroy:()=>{a=[]}}};return'<ul class="fw navc"><li class="sel">Home</li><li>Routines</li><li>Settings</li></ul>'});m("#card{height:100%;position:fixed;width:100%;top:100%;background:rgba(83,83,83,.47058823529411764)}#card.an{transition:top .2s ease-in-out}");
m(".sc{padding:20px}.slider{background:linear-gradient(90deg,#db8b1d 0,#db8b1d 50%,#606060 0,#606060);border-radius:8px;height:7px;width:75%;border-radius:15px;height:6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;outline:none}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:#fff;box-shadow:#000;border-radius:50%;cursor:pointer}");
let p=document.getElementById.bind(document),q=(b,a=document)=>a.querySelector.call(a,b),r=b=>b.stopPropagation(),t=l(function({label:b,value:a,id:c}){this.init=function(d){d.id=c;q("h4",d).innerText=b;const e=q("input",d);e.onmousedown=r;e.ontouchstart=r;e.oninput=function(){const a=(parseInt(e.value)-parseInt(e.min))/(parseInt(e.max)-parseInt(e.min))*100;e.style.background="linear-gradient(to right, #DB8B1D 0%, #DB8B1D "+a+"%, #606060 "+a+"%, #606060 100%)"};console.log("slider: ",e,a);e.value=
a;return{destroy:()=>{}}};return'<div class="sc"><div class="fR fSB"><h4>Title</h4><h4>Value</h4></div><input class="slider" type="range" min="0" max="100"></div>'}),u=l(function(){let b=!1,a=0,c=0,d=!1,e={};this.init=function(f){function g(a=!1){a!==d&&(a?f.classList.add("an"):f.classList.remove("an"),d=a)}function k(a){console.log("on transition end: ",a);f.remove()}function h(a){console.log("move event: ",a);let {x:h,y:b}=a;null==h&&(h=a.touches[0].clientX,b=a.touches[0].clientY);return{x:h,y:b}}
g(!0);const C=t({id:"position",label:"Position",value:"50"});f.appendChild(C.node);f.onmousedown=f.ontouchstart=a=>{e=a=h(a);c=a.y;b=!0;g(!1)};f.onmouseup=f.onmouseout=f.ontouchend=()=>{if(b){b=!1;g(!0);var h=0;a>f.clientHeight/2&&(h=f.clientHeight,f.ontransitionend=k);f.style.top=`${h}px`;a=c=0}};f.onmousemove=f.ontouchmove=d=>{d=h(d);b&&(0>d.y-c?e=d:(a+=d.y-e.y,e=d,f.style.top=`${a}px`))};return{destroy:k,show:()=>{f.style.top="0px"}}};return'<div id="card" class="an"></div>'});m(".dt{justify-content:space-between}.tile{background:rgba(0,0,0,.30196078431372547);border-radius:12px;display:flex}.tile.sq{width:110px;height:110px;margin:5px 0;position:relative}.tile.sq>span{width:109px;max-height:90px;top:10px;position:absolute;right:0;border-right:1px groove #fff}.pt>.sq{height:50px;width:auto;min-width:150px}.pt>.sq>span{display:none}.tile.sq p{font-size:11px;margin:auto 21px 10px 9px;font-weight:500}");
let v=l(function({name:b,id:a}){let c=[];this.init=function(d){d.id=a;d.onclick=()=>{c.forEach(c=>c({id:a,name:b}))};q("p",d).innerText=b;return{onClick:a=>{c.push(a)},destroy:()=>{c=[]}}};return'<div class="tile sq"><span></span><p>Bedroom Left</p></div>'});
class w{constructor(){this._observers={};this._state={state:{pos:0,tPos:0,accel:0,speed:0},settings:{deviceName:""},devices:{},presets:{}}}get(b){b=b.split(".");let a=this._state;for(;0<b.length;){if("object"!==typeof a)return;a=a[b.shift()]}return a}update(b,a){var c,d;null!==(c=(d=this._observers)[b])&&void 0!==c?c:d[b]=[];let e=this._state[b];this._state[b]=a;this._observers[b].forEach(b=>{b({value:{...a},prev:e})})}observe(b,a){var c,d;null!==(c=(d=this._observers)[b])&&void 0!==c?c:d[b]=[];this._observers[b].push(a);
this._state[b]&&a({value:{...this._state[b]},prev:void 0})}}
let x=new w,y=l(function(){let b=!0,a=[],c=[];this.init=function(){function d(){b&&(p("hl").style.display="none",p("hlc").classList.remove("hide"),b=!1)}function e(a){a=p(`${a}-tiles`);return{container:a,tiles:a.querySelectorAll("div")}}function f(a){const {container:b,tiles:h}=e(a);a=Math.floor(b.clientWidth/110);let c=h.length;for(;0!==c%a;){const a=document.createElement("div");a.classList.add("tile","sq","em");b.appendChild(a);c++}}function g(b,c){const {container:h,tiles:d}=e(b);d.forEach(a=>
{a.id in c&&(c[a.id]=void 0)});for(const [d,g]of Object.entries(c)){if(!g)continue;const c=v({id:`tile-${d}`,name:g.name||d,...g});c.onClick(a=>k(b,a));a.push(c);h.appendChild(c.node)}f(b)}function k(a,b){"device"===a&&c.forEach(a=>a(b))}x.observe("presets",({value:a,prev:b})=>{console.log("presets updated: ",a,b);d();g("preset",a)});x.observe("devices",({value:a,prev:b})=>{console.log("devices updated: ",a,b);d();g("device",a)});return{onDeviceClick:a=>{c.push(a)},destroy:()=>{c=[];a.forEach(a=>
a.destroy());a=[]}}};return'<div class="f flex" id="h"><div class="loader" id="hl"></div><div id="hlc" class="hide" style="text-align: left;"><h1 id="ht">WBlinds</h1><h4 class="hst">Presets</h4><div id="preset-tiles" class="pt fw flex wrap"></div><h4 class="hst">Devices</h4><div id="device-tiles" class="dt fw flex wrap"></div></div></div>'}),z={init:()=>{},restore:()=>{}};console.log("use mocks: ","true","string");
{let b=window.fetch,a={"Going to bed":{state:{"mac-address":{position:50,speed:50,accel:50},"mac-address-2":{position:50,speed:50,accel:50}},routines:[]}},c={"mac-address":{name:"Bedroom Left",position:50,speed:50,accel:50},"mac-address-2":{name:"Bedroom Right",position:50,speed:50,accel:50},"mac-address-3":{name:"Bay Window Left",position:50,speed:50,accel:50},"mac-address-4":{name:"Bay Window Middle",position:50,speed:50,accel:50},"mac-address-5":{name:"Bay Window Right",position:50,speed:50,accel:50}};
z={init:()=>{window.fetch=async b=>({json:()=>"/devices"===b?c:a,ok:!0})},restore:()=>{window.fetch=b}}}let A=z;var B,D=B||(B={});D.GET="GET";D.POST="POST";function E(b,a){console.log("this: ",this);return fetch(b,{method:a}).then(a=>{if(!a.ok)throw a;return a.json()})}let F=[4,5,22,24],G="pos tPos speed accel deviceName mDnsName emitSyncData pinStep pinDir pinEn pinSleep pinReset pinMs1 pinMs2 pinMs3 pinHomeSw cordLength cordDiameter axisDiameter stepsPerRev resolution mqttEnabled mqttHost mqttPort mqttTopic moveUp moveDown moveStop tick".split(" ");
var H,I=H||(H={});I[I.UpdateSettings=0]="UpdateSettings";I[I.UpdateState=1]="UpdateState";
function J(b={}){function a(){d=new WebSocket(`ws://${window.location.hostname}/ws`);d.onopen=a=>{e=!0;f=0;b.onConnect&&b.onConnect(a,f)};d.onclose=c=>{e=!1;b.onDisconnect&&b.onDisconnect(c,f);setTimeout(a,Math.min(5E3*++f,6E4))};d.onmessage=a=>{a=c(a.data);b.onMessage&&a.map(a=>b.onMessage(a))};d.onerror=a=>{e=!1;b.onError&&b.onError(a,f)}}function c(a){console.log("unpackMessages: ",a);var b=a.split("/");a=b.shift();let c=parseInt(b.shift()),d={},e={},f=1;for(let a=0,h=G.length;a<h&&0<b.length;a++){if(f&
c){let c=G[a],h=b.shift();4>a?d[c]=parseInt(h):e[c]=a in F?h:parseInt(h)}f<<=1}b=[];0<Object.keys(d).length&&b.push({type:1,mac:a,data:d});0<Object.keys(e).length&&b.push({type:0,mac:a,data:e});return b}let d,e=!1,f=0;a();return{ws:d,push:()=>{e&&d.send("")}}}m(".tc{display:flex;position:absolute;top:0;flex-flow:column-reverse;pointer-events:none;height:calc(100% - 63px);padding-bottom:63px}");m(".toast{background-color:rgba(0,0,0,.4392156862745098);box-shadow:1px 1px 8px rgba(84,84,84,.45098039215686275);border-radius:10px;margin:10px;height:80px;display:flex;max-width:700px;position:relative;transition:bottom .5s ease-in-out;pointer-events:all}.tom{margin:auto}");
let K=l(function({message:b,id:a}){let c=[];this.init=function(d){d.onclick=()=>{c.forEach(b=>b({id:a}))};q("p",d).innerText=b;return{onClick:a=>{c.push(a)},destroy:()=>{c=[]}}};return'<div class="toast"><p class="tom"></p></div>'}),L=l(function(){let b=0,a=[];this.init=function(c){console.log("toast container: ",c);return{destroy:()=>{a.map(a=>a.destroy());a=[];b=0},pushToast:function(d,e,f,g=2500){function k(){h.node.style.bottom=`-${63+200*(a.length+1)}px`;setTimeout(()=>{h.node.remove()},500)}
const h=K({message:d,isError:e,id:b++});h.node.style.bottom=`-${63+200*(a.length+1)}px`;h.onClick(k);a.push(h);c.appendChild(h.node);setTimeout(()=>{h.node.style.bottom="0px";!f&&setTimeout(k,g)})}}};return'<div id="toc" class="fw tc"></div>'});
function M(){function b(b){var c;console.log("on click! ",b);if(f!==b){f=b;null===(c=null===g||void 0===g?void 0:g.destroy)||void 0===c?void 0:c.call(g);console.log("currentTab.node: ",null===g||void 0===g?void 0:g.node);null===g||void 0===g?void 0:g.node.remove();switch(b){case 0:b=y();b.onDeviceClick(a);g=b;console.log("node: ",g.node);break;case 1:g=null;break;case 2:g=null}g&&d.appendChild(g.node)}}function a(a){console.log("device clicked: ",a);a=u({});c.appendChild(a.node);setTimeout(a.show)}
A.init();let c=q("body"),d=p("app");window.wblinds.State=x;let e=L({});c.appendChild(e.node);window.onerror=a=>{e.pushToast(a.toString(),!0)};E("/state").then(a=>{console.log("state res: ",a);x.update("state",a)});E("/presets").then(a=>{console.log("presets res: ",a);x.update("presets",a)});E("/devices").then(a=>{console.log("devices res: ",a);x.update("devices",a)});let f=-1,g;b(0);J({onMessage(a){console.log("WS msg: ",a);0===a.type&&x.update("settings",{...x.get("settings"),...a.data})},onError(a,
b){b||e.pushToast("Websocket disconnected!",!0,!1,5E3)},onConnect(a,b){console.log("WS connect: ",a);b&&e.pushToast("Websocket connected!")},onDisconnect(a){console.log("WS disconnect: ",a)}});let k=n();console.log("node: ",k.node);p("nav").appendChild(k.node);console.log("nav: ",k.currentIndex());k.onClick(b)}m(':root{--blue:#06c;--green:#32d74b;--input:#db8b1d}html{touch-action:manipulation}body{margin:0;background-color:#111;font-family:-apple-system,BlinkMacSystemFont,helvetica,sans-serif;font-size:17px;font-weight:400;color:#fff;text-align:center;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;scrollbar-width:6px;scrollbar-color:var(--c-sb) transparent}body,html{height:100%;width:100%;position:fixed;-ms-scroll-chaining:none;overscroll-behavior:none}h1,h4{font-weight:400}h1{font-size:32px}h4{-webkit-margin-after:.3em;margin-block-end:.3em;font-size:14px;padding-left:5px}.hide{display:none}.loader,.loader:after,.loader:before{border-radius:50%;width:2.5em;height:2.5em;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation:load7 1.8s ease-in-out infinite;animation:load7 1.8s ease-in-out infinite}.loader{margin:auto;color:#fff;font-size:10px;text-indent:-9999em;transform:translate3d(0,-100px,0);-webkit-animation-delay:-.16s;animation-delay:-.16s;align-self:center}.loader:after,.loader:before{content:"";position:absolute;top:0}.loader:before{left:-3.5em;-webkit-animation-delay:-.32s;animation-delay:-.32s}.loader:after{left:3.5em}@-webkit-keyframes load7{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes load7{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}.em{opacity:0}ul{display:flex;list-style-type:none;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;-webkit-padding-start:0;padding-inline-start:0}li{display:list-item;text-align:-webkit-match-parent;color:hsla(0,0%,100%,.4)}li.s{color:#db8b1d}.f{width:100%;height:100%}.fC,.flex{display:flex}.fC{flex-direction:column}.fR{display:flex;flex-direction:row}.fSB{justify-content:space-between}.wrap{flex-wrap:wrap}.fh{height:100%}.fw{width:100%}#bg{height:100vh;width:100vw;position:fixed;z-index:-10;background-position:30%;background-repeat:no-repeat;background-size:cover;opacity:1;transition:opacity 2s;background-image:url(https://github.com/maxakuru/WBlinds/blob/main/public/bg.jpg?raw=true),linear-gradient(40deg,#1d0143,#293b7c,#300a52)}#app{display:flex;flex-direction:column;padding:23px 23px 0;height:calc(100% - 86px);overflow-y:scroll}.overlay{position:fixed;height:100%;width:100%;top:0;left:0;background-color:#333;font-size:24px;display:flex;align-items:center;justify-content:center;z-index:11;opacity:.95;transition:.7s;pointer-events:none}');
window.wblinds={test:!0};window.onload=()=>M()

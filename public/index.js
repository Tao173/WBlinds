import{appendChild as appendChild$1,addClass as addClass$1,removeClass as removeClass$1}from'@Util';import{Component as Component$1,Slider}from'@Components';function n(b){return(...a)=>{var c={};a=b.call(c,...a);a=(new DOMParser).parseFromString(a,"text/html");console.log("ctx: ",c);a=a.getElementsByTagName("body").item(0).firstChild;c=c.init.call(c,a);c.node=a;return c}}
function p(b,a){void 0===a&&(a={});a=a.insertAt;if(b&&"undefined"!==typeof document){var c=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css";"top"===a?c.firstChild?c.insertBefore(d,c.firstChild):c.appendChild(d):c.appendChild(d);d.styleSheet?d.styleSheet.cssText=b:d.appendChild(document.createTextNode(b))}}p("#nav{background:rgba(0,0,0,.5019607843137255);height:63px;display:flex}.navc{justify-content:space-evenly;align-self:center}.navc .sel{color:#db8b1d}");
function q(b,...a){b.classList.add(...a)}function r(b,...a){b.classList.remove(...a)}let t=setTimeout,u=document.createElement.bind(document),v=document.createElement.bind(document,"div"),w=document.getElementById.bind(document),x=(b,a=document)=>a.querySelector.call(a,b);function y(b){return b&&"object"===typeof b&&!Array.isArray(b)}
function z(b,...a){if(!a.length)return b;let c=a.shift();if(y(b)&&y(c))for(let a in c)y(c[a])?(b[a]||Object.assign(b,{[a]:{}}),z(b[a],c[a])):Object.assign(b,{[a]:c[a]});return z(b,...a)}function A(b){let a={};for(let c in b)null!=b[c]&&(a[c]=b[c]);return a}
let B=(b,a)=>b.appendChild(a),C=n(function(){let b=0,a=[];this.init=function(c){console.log("elem: ",c);const d=c.querySelectorAll("li");console.log("buttons: ",d);d.forEach((c,e)=>{c.addEventListener("click",()=>{b=e;d.forEach((a,c)=>{c===b?q(a,"sel"):r(a,"sel")});a.map(a=>a.call(void 0,e))})});return{onClick:b=>{a.push(b)},currentIndex:()=>b,destroy:()=>{a=[]}}};return'<ul class="fw navc"><li class="sel">Home</li><li>Routines</li><li>Settings</li></ul>'});p("#card{height:100%;position:fixed;width:100%;top:100%;background:rgba(83,83,83,.47058823529411764)}#card.an{transition:top .2s ease-in-out}");
let D=Component$1(function(){let b=!1,a=0,c=0,d=!1,f={};this.init=function(e){function k(a=!1){a!==d&&(a?addClass$1(e,"an"):removeClass$1(e,"an"),d=a)}function g(a){console.log("on transition end: ",a);e.remove()}function l(a){console.log("move event: ",a);let {x:b,y:c}=a;null==b&&(b=a.touches[0].clientX,c=a.touches[0].clientY);return{x:b,y:c}}k(!0);const h=Slider({id:"position",label:"Position",value:"50"});appendChild$1(e,h.node);e.onmousedown=e.ontouchstart=a=>{f=a=l(a);c=a.y;b=!0;k(!1)};e.onmouseup=
e.onmouseout=e.ontouchend=()=>{if(b){b=!1;k(!0);var d=0;a>e.clientHeight/2&&(d=e.clientHeight,e.ontransitionend=g);e.style.top=`${d}px`;a=c=0}};e.onmousemove=e.ontouchmove=d=>{d=l(d);b&&(0>d.y-c?f=d:(a+=d.y-f.y,f=d,e.style.top=`${a}px`))};return{destroy:g,show:()=>{e.style.top="0px"}}};return'<div id="card" class="an"></div>'});p(":root{--wid:min(calc(33.33333vw - 20px),110px)}.tile{background:rgba(0,0,0,.30196078431372547);border-radius:12px;display:flex}.tile.sq{width:var(--wid);height:var(--wid);margin:5px 0;position:relative}.tile.sq>span{width:calc(var(--wid) - 1px);max-height:90px;top:10px;position:absolute;right:0;border-right:1px groove #fff}.pt>.sq{height:50px;width:auto;min-width:150px}.pt>.sq>span{display:none}.tile.sq p{font-size:11px;margin:auto 21px 10px 9px;font-weight:500}");
let E=n(function({name:b,id:a}){let c=[];this.init=function(d){d.id=a;d.onclick=()=>{c.forEach(c=>c({id:a,name:b}))};x("p",d).innerText=b;return{onClick:a=>{c.push(a)},destroy:()=>{c=[]}}};return'<div class="tile sq"><span></span><p>Bedroom Left</p></div>'});p(".sc{padding:20px}.slider{background:linear-gradient(90deg,#db8b1d 0,#db8b1d 50%,#606060 0,#606060);border-radius:8px;height:7px;width:75%;border-radius:15px;height:6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;outline:none}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:#fff;box-shadow:#000;border-radius:50%;cursor:pointer}");
p(':root{--bord:1px solid rgba(0,0,0,0.034)}#pas{border-radius:7px;justify-content:center;background:rgba(118,118,128,.23921568627450981);border:2px solid transparent}#pas>div{padding:2px 0;flex-grow:1;text-align:center;font-size:14px;border:1px solid hsla(0,0%,100%,0)}#pas>div.sel{background-color:rgba(103,103,105,.6392156862745098);border-radius:7px;border:1px solid rgba(0,0,0,.1411764705882353)}#pas>div:after{height:13px;content:"";display:block;position:absolute;border-left:1px solid rgba(142,142,147,.45098039215686275);border-radius:.5px;transform:translate(-1px,-110%)}#pas>div:first-child:after{border-left:none}');
let F=n(function({items:b}){let a=0,c=[],d=[];this.init=function(f){b.map((b,k)=>{const e=v();e.innerText=b;k===a&&q(e,"sel");e.onclick=()=>{r(d[a],"sel");a=k;q(e,"sel");c.map(a=>a(k))};d.push(e);f.appendChild(e)});return{destroy:()=>{c=[];a=0;d=[]},index:()=>a,onChange:function(a){c.push(a)}}};return'<div id="pas" class="fw flex fR"></div>'});p(".toast{background-color:rgba(0,0,0,.4392156862745098);box-shadow:1px 1px 8px rgba(84,84,84,.45098039215686275);border-radius:10px;font-size:13px;margin:10px;height:60px;display:flex;min-width:250px;max-width:500px;position:relative;transition:bottom .5s ease-in-out;pointer-events:all;align-self:center}.tom{margin:auto}");
let G=n(function({message:b,id:a}){let c=[];this.init=function(d){d.onclick=()=>{c.forEach(b=>b({id:a}))};x("p",d).innerText=b;return{onClick:a=>{c.push(a)},destroy:()=>{c=[]}}};return'<div class="toast"><p class="tom"></p></div>'});p('.in{justify-content:space-between;height:50px;align-items:center;background:rgba(0,0,0,.5607843137254902);padding:0 15px;margin-top:10px;border-radius:15px;min-width:300px}.in>label{font-weight:700;font-size:14px}.igroup>.in{margin-top:0;border-radius:0;border-bottom:1px solid hsla(0,0%,100%,.30196078431372547)}.igroup>.in:first-child{border-radius:15px 15px 0 0}.igroup>.in:last-child{border-radius:0 0 15px 15px;margin-bottom:10px;border-bottom:none}.in>input{background-color:transparent;border:none;text-align:right;color:#db8b1d}[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:51px;height:31px;border-radius:50px;background-color:rgba(148,148,154,.2)!important}[type=checkbox]:after{content:"";width:50%;border-radius:100%;height:80%;display:block;position:relative;background-color:#fff;top:12%;left:3%;transition:left .2s ease-in-out}[type=checkbox].on{background-color:#34c759!important}[type=checkbox].on:after{left:45%}');
var H,I=H||(H={});I[I.String=0]="String";I[I.Boolean=1]="Boolean";I[I.Number=2]="Number";I[I.Enum=3]="Enum";
let J={0:"text",1:"checkbox",2:"number",3:"select"},K=n(function({label:b,type:a,value:c}){let d=[];this.init=function(f){const e=`cb-${b.split(" ").join("-")}`,k=f.firstChild;k.innerText=b;k.htmlFor=e;const g=u("input");g.type=J[a];g.placeholder="placeholder";g.id=e;1===a&&((g.checked=c)&&q(g,"on"),g.onchange=()=>{g.classList.toggle("on")});f.appendChild(g);return{onClick:a=>{d.push(a)},destroy:()=>{d=[]}}};return'<div class="fR in"><label></label></div>'});p(".tc{display:flex;position:absolute;top:0;flex-flow:column-reverse;pointer-events:none;height:calc(100% - 63px);padding-bottom:63px}");
let L=n(function(){let b=0,a=[];this.init=function(c){console.log("toast container: ",c);return{destroy:()=>{a.map(a=>a.destroy());a=[];b=0},pushToast:function(d,f,e,k=2500){function g(){l.node.style.bottom=`-${63+200*(a.length+1)}px`;setTimeout(()=>{l.node.remove()},500)}const l=G({message:d,isError:f,id:b++});l.node.style.bottom=`-${63+200*(a.length+1)}px`;l.onClick(g);a.push(l);c.appendChild(l.node);setTimeout(()=>{l.node.style.bottom="0px";!e&&setTimeout(g,k)})}}};return'<div id="toc" class="fw tc"></div>'}),
M={gen:{deviceName:"WBlinds",mdnsName:"WBlinds",emitSync:!1},hw:{pStep:19,pDir:18,pEn:13,pSleep:21,pReset:3,pMs1:1,pMs2:5,pMs3:17,pHome:4,cLen:1650,cDia:.1,axDia:15,stepsPerRev:200,res:16},mqtt:{enabled:!1,host:"192.168.0.99",port:1833,topic:"wblinds",user:"user"}},N={state:{pos:0,tPos:0,accel:0,speed:0},settings:z({},M),pendingState:z({},M),devices:{},presets:{}};
class O{constructor(){this._loadedKeys={devices:!1,presets:!1,pendingState:!1,settings:!1,state:!1};this._observers={};this._state=z({},N)}get(b){b=b.split(".");let a=this._state;for(;0<b.length;){if("object"!==typeof a)return;a=a[b.shift()]}return a}isLoaded(b){return this._loadedKeys[b]}update(b,a){var c,d;null!==(c=(d=this._observers)[b])&&void 0!==c?c:d[b]=[];let f=this._state[b];this._state[b]=z({},f,A(a));this._loadedKeys[b]=!0;this._observers[b].forEach(b=>{b({value:{...a},prev:f})})}observe(b,
a){var c,d;null!==(c=(d=this._observers)[b])&&void 0!==c?c:d[b]=[];this._observers[b].push(a);this._loadedKeys[b]&&a({value:z({},this._state[b]),prev:void 0})}}let P=new O;p(".dt{justify-content:space-between}");
let aa=n(function(){let b=!0,a=[],c=[];this.init=function(){function d(){if(b){var a=w("hl"),c=w("hlc");a.style.display="none";r(c,"hide");b=!1}}function f(a){a=w(`${a}-tiles`);return{container:a,tiles:a.querySelectorAll("div")}}function e(a){const {container:b,tiles:c}=f(a);var d=b.clientWidth;a=Math.floor(d/110);console.log("client width: ",d);console.log("perRow: ",a);for(d=c.length;0!==d%a;){const a=v();q(a,"tile","sq","em");b.appendChild(a);d++}}function k(b,c){const {container:d,tiles:l}=f(b);
l.forEach(a=>{a.id in c&&(c[a.id]=void 0)});for(const [e,m]of Object.entries(c)){if(!m)continue;const c=E({id:`tile-${e}`,name:m.name||e,...m});c.onClick(a=>g(b,a));a.push(c);d.appendChild(c.node)}e(b)}function g(a,b){"device"===a&&c.forEach(a=>a(b))}t(()=>{P.observe("presets",({value:a,prev:b})=>{console.log("presets updated: ",a,b);d();k("preset",a)});P.observe("devices",({value:a,prev:b})=>{console.log("devices updated: ",a,b);d();k("device",a)})});return{onDeviceClick:a=>{c.push(a)},destroy:()=>
{c=[];a.forEach(a=>a.destroy());a=[]}}};return'<div id="h" class="f flex"><div id="hl" class="loader"></div><div id="hlc" class="hide fw" style="text-align: left;"><h1 id="ht">WBlinds</h1><h4 class="hst">Presets</h4><div id="preset-tiles" class="pt fw flex wrap"></div><h4 class="hst">Devices</h4><div id="device-tiles" class="dt fw flex wrap"></div></div></div>'});p("#pas{margin-bottom:20px}#stcc{display:flex}#stcc>span{margin:auto}#stcc>div{justify-content:center}");var Q,R=Q||(Q={});
R[R.Pins=0]="Pins";R[R.Physical=1]="Physical";R[R.MQTT=2]="MQTT";
let S={gen:{deviceName:{type:0,label:"Device name"},mdnsName:{type:0,label:"mDNS Name"},emitSync:{type:1,label:"Emit sync data"}},mqtt:{enabled:{type:1,label:"Enabled",group:2},host:{type:0,label:"Host",group:2},port:{type:2,label:"Port",group:2},topic:{type:0,label:"Topic",group:2},user:{type:0,label:"Username",group:2}},hw:{axDia:{type:2,label:"Axis diameter",group:1},cDia:{type:2,label:"Cord diameter",group:1},cLen:{type:2,label:"Cord length",group:1},pDir:{type:2,label:"Direction pin",group:0},
pEn:{type:2,label:"Enable pin",group:0},pHome:{type:2,label:"Home switch pin",group:0},pMs1:{type:2,label:"Microstep pin 1",group:0},pMs2:{type:2,label:"Microstep pin 2",group:0},pMs3:{type:2,label:"Microstep pin 3",group:0},pReset:{type:2,label:"Reset pin",group:0},pSleep:{type:2,label:"Sleep pin",group:0},pStep:{type:2,label:"Step pin",group:0},stepsPerRev:{type:2,label:"Steps/revolution",group:1},res:{type:3,label:"Resolution",group:1,enumOpts:[1,4,8,16]}}},ba=n(function(){function b(a){const b=
u("span"),c=[];for(const m in S[a]){const {group:f,label:k,type:g,enumOpts:h}=S[a][m];var d=`${"settings"}.${a}.${m}`;console.log("state key: ",d);console.log(" State.get(stateKey): ",P.get(d));d=K({label:k,type:g,enumOpts:h,value:P.get(d)});var e=f;if(null==e)e=b;else{if(null==c[e]){const a=v();q(a,"igroup");c[e]=a;b.appendChild(a)}e=c[e]}e.appendChild(d.node)}return b}let a=!0,c=[];const d=F({items:["General","Hardware","MQTT"]});let f,e,k;this.init=function(){function g(a){console.log("display tab: ",
a);const b=w("stcc");let c;0===a?c=f:1===a?c=e:2===a&&(c=k);b.innerHTML="";console.log("append: ",c);b.appendChild(c)}d.onChange(g);t(()=>{P.observe("settings",({value:c,prev:h})=>{console.log("settings updated: ",c,h);console.log("settings loaded: ",P._state);a&&(h=w("sl"),c=w("slc"),h.style.display="none",r(c,"hide"),c.prepend(d.node),a=!1,h=v(),h.id="stcc",c.appendChild(h),f=b("gen"),e=b("hw"),k=b("mqtt"),g(d.index()))})});return{destroy:()=>{c.forEach(a=>a.destroy());c=[]}}};return'<div id="ps" class="f flex"><div id="sl" class="loader"></div><div id="slc" class="hide fw" style="text-align: left;"></div></div>'}),
T={init:()=>{},restore:()=>{}};console.log("use mocks: ","true","string");
{let b=window.fetch,a={"/state":{GET:{pos:50,tPos:50,speed:1E3,accel:9999999}},"/presets":{GET:{"Going to bed":{state:{"mac-address":{position:50,speed:50,accel:50},"mac-address-2":{position:50,speed:50,accel:50}},routines:[]}}},"/devices":{GET:{"mac-address":{name:"Bedroom Left",position:50,speed:50,accel:50},"mac-address-2":{name:"Bedroom Right",position:50,speed:50,accel:50},"mac-address-3":{name:"Bay Window Left",position:50,speed:50,accel:50},"mac-address-4":{name:"Bay Window Middle",position:50,
speed:50,accel:50},"mac-address-5":{name:"Bay Window Right",position:50,speed:50,accel:50}}}};T={init:()=>{window.fetch=async(b,d={})=>{let c=d.method||"GET",e=!!a[b]&&!!a[b][c];return Promise.resolve({json:()=>e?a[b][c]:{},statusCode:e?200:404,ok:e})}},restore:()=>{window.fetch=b}}}let ca=T;var U,V=U||(U={});V.GET="GET";V.POST="POST";function da(b,a,c={}){return W(b,a,c)}
function W(b,a,c={},d=0){return fetch(`${""}${b}`,{method:a}).then(f=>{if(!f.ok){d+=1;if(8<d){let c=Error(`Failed with ${f.status} on fetch [${a}] ${b}`);c.response=f;throw c;}setTimeout(W.bind(b,a,c,d),5E3*d)}return f.json()})}let ea=[4,5,22,24],X="pos tPos speed accel deviceName mdnsName emitSyncData pinStep pinDir pinEn pinSleep pinReset pinMs1 pinMs2 pinMs3 pinHomeSw cordLength cordDiameter axisDiameter stepsPerRev resolution mqttEnabled mqttHost mqttPort mqttTopic moveUp moveDown moveStop tick".split(" ");
var Y,Z=Y||(Y={});Z[Z.UpdateSettings=0]="UpdateSettings";Z[Z.UpdateState=1]="UpdateState";
function fa(b={}){function a(){d=new WebSocket(`ws://${window.location.hostname}/ws`);d.onopen=a=>{f=!0;e=0;b.onConnect&&b.onConnect(a,e)};d.onclose=c=>{f=!1;b.onDisconnect&&b.onDisconnect(c,e);setTimeout(a,Math.min(5E3*++e,6E4))};d.onmessage=a=>{a=c(a.data);b.onMessage&&a.map(a=>b.onMessage(a))};d.onerror=a=>{f=!1;b.onError&&b.onError(a,e)}}function c(a){console.log("unpackMessages: ",a);var b=a.split("/");a=b.shift();let c=parseInt(b.shift()),d={},e={},f=1;for(let a=0,m=X.length;a<m&&0<b.length;a++){if(f&
c){let c=X[a],m=b.shift();4>a?d[c]=parseInt(m):e[c]=a in ea?m:parseInt(m)}f<<=1}b=[];0<Object.keys(d).length&&b.push({type:1,mac:a,data:d});0<Object.keys(e).length&&b.push({type:0,mac:a,data:e});return b}let d,f=!1,e=0;a();return{ws:d,push:()=>{f&&d.send("")}}}
function ha(b){function a(a){var b;console.log("on click! ",a);if(l!==a){l=a;null===(b=null===h||void 0===h?void 0:h.destroy)||void 0===b?void 0:b.call(h);console.log("currentTab.node: ",null===h||void 0===h?void 0:h.node);null===h||void 0===h?void 0:h.node.remove();switch(a){case 0:a=aa();a.onDeviceClick(c);h=a;break;case 1:h=null;break;case 2:h=ba(),P.isLoaded("settings")||d("settings").then(a=>a&&P.update("pendingState",a))}h&&k.appendChild(h.node)}}function c(a){console.log("device clicked: ",
a);a=D({});e.appendChild(a.node);setTimeout(a.show)}function d(a){return da(`/${a}`).then(b=>{P.update(a,b);return b}).catch(f)}function f(a){console.error(a);a=y(a)?(null===a||void 0===a?void 0:a.message)||"Error encountered, check console":a;g.pushToast(a,!0)}ca.init();let e=x("body"),k=w("app");b.state=P;let g=L({});e.appendChild(g.node);window.onerror=f;let l=-1,h;a(0);d("state");d("presets");d("devices");fa({onMessage(a){console.log("WS msg: ",a);0===a.type&&P.update("settings",{...P.get("settings"),
...a.data})},onError(a,b){b||g.pushToast("Websocket disconnected!",!0,!1,5E3)},onConnect(a,b){console.log("WS connect: ",a);b&&g.pushToast("Websocket connected!")},onDisconnect(a){console.log("WS disconnect: ",a)}});b=C();console.log("node: ",b.node);B(w("nav"),b.node);console.log("nav: ",b.currentIndex());b.onClick(a)}p('html{touch-action:manipulation}body{margin:0;background-color:#111;font-family:-apple-system,BlinkMacSystemFont,helvetica,sans-serif;font-size:17px;font-weight:400;color:#fff;text-align:center;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;scrollbar-width:6px;scrollbar-color:var(--c-sb) transparent}body,html{height:100%;width:100%;position:fixed;-ms-scroll-chaining:none;overscroll-behavior:none}:focus{outline:none}h1,h4{font-weight:400}h1{font-size:32px}h4{-webkit-margin-after:.3em;margin-block-end:.3em;font-size:14px;padding-left:5px}.hide{display:none}.loader,.loader:after,.loader:before{border-radius:50%;width:2.5em;height:2.5em;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation:load7 1.8s ease-in-out infinite;animation:load7 1.8s ease-in-out infinite}.loader{margin:auto;color:#fff;font-size:10px;text-indent:-9999em;transform:translate3d(0,-100px,0);-webkit-animation-delay:-.16s;animation-delay:-.16s;align-self:center}.loader:after,.loader:before{content:"";position:absolute;top:0}.loader:before{left:-3.5em;-webkit-animation-delay:-.32s;animation-delay:-.32s}.loader:after{left:3.5em}@-webkit-keyframes load7{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes load7{0%,80%,to{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}.em{opacity:0}ul{display:flex;list-style-type:none;-webkit-margin-before:0;margin-block-start:0;-webkit-margin-after:0;margin-block-end:0;-webkit-padding-start:0;padding-inline-start:0}li{display:list-item;text-align:-webkit-match-parent;color:hsla(0,0%,100%,.4)}li.s{color:#db8b1d}.f{width:100%;height:100%}.fC,.flex{display:flex}.fC{flex-direction:column}.fR{display:flex;flex-direction:row}.fSB{justify-content:space-between}.wrap{flex-wrap:wrap}.fh{height:100%}.fw{width:100%}#bg{height:100vh;width:100vw;position:fixed;z-index:-10;background-position:30%;background-repeat:no-repeat;background-size:cover;opacity:1;transition:opacity 2s;background-image:url(https://github.com/maxakuru/WBlinds/blob/main/public/bg.jpg?raw=true),linear-gradient(40deg,#1d0143,#293b7c,#300a52)}#app{display:flex;flex-direction:column;padding:23px 23px 0;height:calc(100% - 86px);overflow-y:scroll}.overlay{position:fixed;height:100%;width:100%;top:0;left:0;background-color:#333;font-size:24px;display:flex;align-items:center;justify-content:center;z-index:11;opacity:.95;transition:.7s;pointer-events:none}');
let ia=window.wblinds={};window.onload=()=>ha(ia)
